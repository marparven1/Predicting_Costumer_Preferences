---
title: "Proyecto Blackwell Electronics. Data Science Process"
subtitle: "Módulo 3 Tarea 3: Regresión múltiple. Análisis de predicción de ventas"
author: "Marta Venegas Pardo"
date: "10 de Diciembre de 2021"
output:
  prettydoc::html_pretty:
    theme: leonids
    highlight: github
    toc: yes
    toc_depth: 5
    number_sections: yes
lang: es
---

```{r setup, include=FALSE,message=FALSE,warning=FALSE}
knitr::opts_chunk$set(message=FALSE,warning=FALSE , echo = FALSE)
```

```{r librerías}
dire<-getwd() 
setwd(dire) 

# Librerías necesarias
library(dplyr)
library(kableExtra)
library(knitr)

# Gráficos
library(ggplot2)
library(scales)
library(ggrepel)
library(hrbrthemes)

## Matriz de correlación 
library(corrplot)
# Análisis exploratioro
library(SmartEDA)

library(ggrepel)
# Modelado
library(caret)
```

# Introducción (definición del problema + objetivos)

## Objetivos

El equipo de ventas de Blackwell Electronics solicita que analicemos los datos correspondientes a las ventas de distintos productos con el **objetivo** de:

- Entender como varía el volumen de ventas en función del tipo de producto
- Predecir las ventas de cuatro tipos de productos diferentes: PC, portátiles, netbooks y teléfonos inteligentes
- Evaluar el impacto que tienen las revisiones de los servicios y las reseñas de los clientes en el volumen de ventas de diferentes tipos de productos


Para ello, analizaremos los datos correspondientes al histórico de ventas para hacer predicciones del volumen de ventas de los nuevos productos. 




## Qué encontraremos en este informe

- Descripción de los datos y variables predictoras de las ventas de cada producto
- Limpieza de datos y preparación para el modelado
- Análisis exploratorio, resumen de mis datos, representaciones gráficas,
- Modelado, prueba de diferentes modelos con diferentes hiperparametrizaciones, entrenamiento de los modelos con validación y testeo de los modelos
- Test final del mejor modelo y predicción del volumen de ventas de los nuevos productos en el conjunto de datos "new product" 
- Conclusiones



## Procedimiento para cumplir mis objetivos

- Descripción de datos, pre-procesado, limpieza de los datos, análisis exploratorio y feature engineering 
- Modelado a través de algoritmos de regresión , como por ejemplo: regresión lineal, support vector machine y random forest 
- Decisión del algoritmo que nos proporciona el mejor modelo de cara a predecir el volumen de ventas de los diferentes productos
- Una vez tengamos el modelo final, predecir las ventas de los cuatro tipos de productos informáticos


# Descripción de los conjuntos de datos



-   Conjuntos de datos:

    -   **DatosProdExistentes**: Histórico de ventas con los 80 productos existentes, sus características y valoraciones
    -   **DatosProdNuevos**: Dataset con 24 nuevos productos, sus características y valoraciones
    
Aquí encontramos la primera limitación de los datos, tenemos muy pocos registros y de cara a modelar nuestra variable _volumen de ventas_ esto va a suponer un problema para dividir en datos de entrenamiento y testeo, pero es algo que desarrollaremos en el apartado de modelado.

```{r}
DatosProdExistentes<-read.csv(file="DATOS/existingproductattributes2017.csv",header = TRUE,sep = ",",dec ="." )

DatosProdNuevos<-read.csv(file="DATOS/newproductattributes2017.csv",header = TRUE,sep = ",",dec =".")
```

Vamos a visualizar los datos:

```{r}
DatosProdExistentes %>% 
  head(10) %>% 
  kable(booktabs=TRUE,caption = "Histórico de ventas. Datos: Productos existentes") %>% 
  kable_styling(latex_options = "striped")
```

```{r}
DatosProdNuevos %>% 
  head(10) %>% 
  kable(booktabs=TRUE,caption = "Datos: Productos nuevos") %>% 
  kable_styling(latex_options = "striped")
```






## Descripción de variables

-   Datos del histórico de ventas: 80 productos diferentes
-   Datos de nuevos productos: 24 productos diferentes

En ambos conjuntos de datos encontramos 18 variables :

-   **Product type**: Tipo de producto. Encontramos 12 tipos diferentes (Accesorios, monitor ordenador portatil, Netbook, impresora, extensión de la garantía, Consola, accesorios de impresora, teléfonos inteligentes, tabletas, software). (Variable categórica)

-   **ProductNum**: Identificador del producto, es único para cada producto (Variable numérica)

-   **XiStarReviews**: cinco variables correspondientes a la calificación (de 1 a 5) que le dan los clientes al producto   (Variable numérica, que indica el número de veces que se le ha dado esa puntiación) Estas variables son: 1 estrella, 2 estrellas, 3 estrellas,  4 estrellas, y 5 estrellas

-   **PositiveServiceReview**: Número de veces que se ha dado una reseña positiva por el servicio prestado. (numérica)
-   **NegativeServiceReview**: Número de veces que se ha dado una reseña negativa por el servicio prestado. (numérica)
-   **RecommendProduct**: Puntuación entre 0 y 1 que indica si se recomendaría o no el producto (variable numérica)
-   **Best Seller Rank**: Puesto que ocupa en un ránking de productos  (variable numérica entera)
-   **Shipping Weigth**: Peso del envío (variable numérica)
-   **Product Depth**: Dimensiones de la profundidad del producto (variable numérica)
-   **Product Width**: Dimensiones del ancho del producto (variable numérica)
-   **Product Heigth**: Dimensiones del alto del producto (variable numérica)
-   **ProfitMargin**: Margen de beneficio que proporciona el producto (numérica)
-   **Target. Volume**: Volumen de ventas de dicho producto. (Variable numérica entera)



```{r}
#dim(DatosProdExistentes)
#dim(DatosProdNuevos)
```


# Preparación de los datos (Limpieza de datos)

En este paso del proceso, trataremos de encontrar, corregir o eliminar registros erróneos (incompletos) en nuestros datos. Para ello estudiaremos si todas las instancias están completas, si existen duplicados, valores atípicos,...

En primer lugar vamos a mostrar los datos en forma de cadena para ver si tenemos todas las variables en la forma correspondiente, por ejemplo: variables numéricas como números, categóricas como factor,...

```{r}
str(DatosProdExistentes)
str(DatosProdNuevos)
```


Todos los datos están en el formato correcto, por lo que por el momento no debemos hacer ningún cambio ni recodificación de ninguna variable.

Mostramos ahora un resumen de los datos, para ver que no existen incongruencias como precios o volúmenes de ventas negativos, valores faltantes o cualquier otro error que pudiera existir en los datos.



```{r}
summary(DatosProdExistentes)
summary(DatosProdNuevos)
```

## Duplicados


Mostramos a continuación, las instancias duplicadas en nuestros datasets:

-   Duplicados en los datos de entrenamiento:

```{r}
DatosProdExistentes[duplicated(DatosProdExistentes)==TRUE,]
```



-   Duplicados en los datos de testeo:

```{r}
DatosProdNuevos[duplicated(DatosProdNuevos)==TRUE,]
```

En la última fila de las salidas vemos _0 rows_, por tanto, en nuestros conjuntos de datos, no existen instancias duplicadas.



## Transformación de variables

### Datos ficticios (dummy)

Tenemos que transformar la variable product type de factor a variable binaria de (0 y 1)

La variable product type es un factor con los siguientes niveles:

```{r}
levels(DatosProdExistentes$ProductType) %>% kable(booktabs=TRUE, col.names  = "Tipos de producto") %>% kable_styling(latex_options = "striped")
```

Vamos a aplicar la función dummyVars para obtener 12 nuevas variables binarias de tipo (0,1)


```{r echo=TRUE}
# dummy of the data
newDataFrame <- dummyVars(" ~ .", data = DatosProdExistentes)
readyData <- data.frame(predict(newDataFrame, newdata = DatosProdExistentes))

str(readyData[,1:12])

```

De la variable product type hemos obtenido 12 variables diferentes, una por cada tipo de producto. Encontramos un 1 si ese artículo pertenece al tipo de producto correspondiente y un 0 en caso contrario.

Al trabajar con este tipo de variables, tenemos gran cantidad de 0, y por tanto, esto puede suponer problemas de cara a realizar modelos de predicción porque la varianza de éstas variables será muy próxima a 0. Trataremos esta limitación en el apartado de análisis exploratorio.




### Factorización de las variables

No es necesario

### Normalización de variables

No necesitamos normalizar las variables para que estén todas en la misma escala, ya la mayoría de variables son ordinales, y las que no lo son (peso, altura del producto,...) se encuentran todas en la misma escala.

```{r}
#scale(x,center = TRUE,scale = TRUE)
```





## Datos faltantes

El conjunto de datos correspondientes al histórico de ventas tiene 15 productos en los que la columna BestSellerRank tiene un valor NA. Es decir, no conocemos la posición en el ranking de mejores vendidos que ocuparían estos productos.

```{r}
# summary(DatosProdExistentes$BestSellersRank)
# summary(DatosProdNuevos$BestSellersRank)
summary(readyData$BestSellersRank)
```

Vamos a ver de que productos se trata:


```{r}
DatosProdExistentes[is.na(DatosProdExistentes$BestSellersRank),] %>% 
  kable(booktabs=TRUE) %>% 
  kable_styling(latex_options = "striped")

```


Las opciones son las siguientes: imputar el valor que ocuparía en el ranking, eliminar esos registros (no debemos), eliminar esa columna del estudio. 

Opción elegida: eliminemos cualquier atributo que tenga datos faltantes.

```{r  echo=TRUE}
DatosProdExistentes$BestSellersRank<- NULL # conjunto de datos original
readyData$BestSellersRank<- NULL # datos dummy
```




## Outliers

En el conjunto de datos *Productos existentes*, encontramos valores atípicos en bastantes variables 

Nota: no estudio outliers de la variable ID: número del producto, porque no tiene sentido.


```{r}
boxplot(DatosProdExistentes[,3:8],main="BoxPlot. Precio y calificación de los productos \n Datos del histórico de ventas")
# $out

boxplot(DatosProdExistentes[,9:10],main="BoxPlot. Reseña de los productos \n 
        Datos del histórico de ventas")

boxplot(DatosProdExistentes[,11],main="BoxPlot. Recommend product \n 
        Datos del histórico de ventas")

boxplot(DatosProdExistentes[,13:16],main="BoxPlot. Dimensiones del prducto \n 
        Datos del histórico de ventas")

boxplot(DatosProdExistentes[,17],main="BoxPlot. Volumen de ventas \n 
        Datos del histórico de ventas",
        xlab="Volumen de ventas")
```

En este último gráfico identificamos dos valores atípicos de ventas (11204 y 7036), que corresponden a un volumen de venta muy grande en comparación al resto. Vamos a identificar de que productos se trata. 

```{r}

DatosProdExistentes %>% 
    filter(Volume==11204 | Volume == 7036) %>% 
#  select("ProductType","Volume","ProductNum") %>% 
  kable(booktabs=TRUE) %>% kable_styling(latex_options = "striped")
  
```


Estos artículos son: un accesorio y un juego para la consola. Estos dos tipos de producto no son productos sobre los que estamos interesados en realizar predicciones.

Los valores atípicos pueden afectar a la variable objetivo _volume_ a la hora de la construcción de modelos de predicción.

Vamos a proceder a eliminar estos dos registros de mi conjunto de datos, ya que no son un tipo de producto en el que estemos interesados y puede afectar negativamente en mi modelo.


```{r echo=TRUE}
DatosProdExistentes2 <- DatosProdExistentes %>% 
    filter(Volume!=11204) %>% 
    filter(Volume !=7036 )


readyData2 <- readyData %>% 
    filter(Volume!=11204) %>% 
    filter(Volume !=7036 )
```







## Creación de variables

No necesario por el momento. Ya, con dummy data nuestro nuevo dataset _readydata_ contiene una nueva variable binaria para cada tipo de producto, con un uno si el producto es de ese tipo y un 0 si no lo es. Un total de 12 nuevas variables






# Análisis exploratorio


## Tipos de productos a la venta en Blackwell

Vamos a ver a modo de gráfica el número de productos de cada tipo que podemos encontrar en las tiendas de Blackwell electronics:

```{r}
# summary(DatosProdExistentes$ProductType)
NumeroProductos <- c(26,5 ,10 , 2 ,3,2,4,12,3,4,6,3)
TipoDeProducto<- DatosProdExistentes$ProductType %>% levels()


productosEx <- cbind.data.frame(TipoDeProducto,NumeroProductos) 

# productosEx %>% kable(booktabs=TRUE) %>% kable_styling(latex_options = "striped")
```



```{r fig.align='center'}
ggplot(data=productosEx, aes(x=reorder(TipoDeProducto,-NumeroProductos) , 
                                     y =NumeroProductos , fill= TipoDeProducto)) + 
    geom_bar(stat="identity", position="dodge")+
    scale_y_continuous(breaks = seq(1,28,by=2))+
      labs(title="Gráfico de barras" ,
         subtitle= "Tipo de producto y número de productos diferentes", 
         caption="Fuente: Elaboración propia. ")+
  xlab("Tipo de producto")+
  ylab("Número de artículos diferentes")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
En Blackwell electronics, encontraremos:

- 26 tipos de accesorios diferentes
- 12 artículos de tipo impresora
- 10 tipos de garantías diferentes
- 6 posibles softwares diferentes
- 5 pantallas de ordenador
- 4 tipos de smartphones distintos, al igual que ordenadores portátiles
- 2 tipos de notebook diferentes y dos consolas
- Encontramos 3 articulos de tipo tables y 3 accesorios para las impresoras


Vamos a estudiar como influyen las distintas variables en **el volumen de ventas** de los diferentes productos, con el objetivo de entender como varían las ventas en función del tipo de producto y si hay relación entre el volumen de ventas y la valoración que dan los clientes a los productos y al servicio recibido.

Para ello, comenzaremos con un breve resumen estadístico de nuestros datos:




## Resumen de los datos

```{r}
# summary(DatosProdExistentes$ProductType)
```





```{r}
summary(readyData)
```


-   **Tipo de producto**: La mayoría de productos que existentes en blackwell eran accesorios, seguido de impresoras y extensiones de la garantía. Para los nuevos productos, la mayoría son smartphones o netbooks


-   **Precio**: El precio medio de los productos existentes en Blackwell es de 247.25 € siendo 2249.99 € el precio del producto más caro y 3.60 € el del más barato.


```{r}
# readyData2[readyData2$Price==3.60,]
# readyData2[readyData2$Price==2249.99,]
# 
DatosProdExistentes[DatosProdExistentes$Price==3.60,1:3] %>% kable(booktabs=TRUE)
DatosProdExistentes[DatosProdExistentes$Price==2249.99,1:3]%>% kable(booktabs=TRUE)
```

El producto más caro es un ordenador PC y los más baratos son artículos que son accesorios


-   **Volumen de ventas**: El volumen medio de ventas es de 705 ventas. Encontramos productos que no se han vendido nunca y por el contrario, el producto que más volumen de ventas hatenido ha sido vendido un total de 11204 veces. Vamos a ver de que productos se trata


```{r}
DatosProdExistentes[DatosProdExistentes$Volume==0,c("ProductType","ProductNum","Volume")] %>% kable(booktabs=TRUE, caption="Productos menos vendidos")
DatosProdExistentes[DatosProdExistentes$Volume==11204,c("ProductType","ProductNum","Volume")]%>% kable(booktabs=TRUE, caption = "Producto más vendido")
```


Veamos ahora las valoraciones de los clientes:


-   **Reseñas por el servicio**:

      - Reseñas positivas: Hay un producto que ha recibido un total de 536 reseñas positivas     por el servicio prestado
      - Reseñas negarivas: El producto que más reseñas negativas ha recibido por el servicio ha    sido uno con un total de 112
  
Vamos a ver de que productos se trata en ambos casos

```{r}
DatosProdExistentes[DatosProdExistentes$PositiveServiceReview==536,
                    c("ProductType","ProductNum","PositiveServiceReview","Volume")] %>% kable(booktabs=TRUE, caption="Producto con mayor número de reseñas de servicio positivo")
DatosProdExistentes[DatosProdExistentes$NegativeServiceReview==112,
                    c("ProductType","ProductNum","PositiveServiceReview","Volume")]%>% kable(booktabs=TRUE, caption = "Producto con mayor número de reseñas por un servicio negativo")
```

-   **Número de estrellas**:

    - 4 estrellas: el máximo son 431 valoraciones de 4 estrellas
    - 2 estrellas: el máximo de valoraciones de 2 estrellas son un total de 370
  
  
```{r}
DatosProdExistentes[DatosProdExistentes$x4StarReviews==431,
                    c("ProductType","ProductNum","x4StarReviews","Volume")] %>% kable(booktabs=TRUE, caption="Producto con mayor número reseñas de 4 estrellas")
DatosProdExistentes[DatosProdExistentes$x2StarReviews==370,
                    c("ProductType","ProductNum","x2StarReviews","Volume")]%>% kable(booktabs=TRUE, caption = "Producto con mayor número de reseñas de 2 estrellas")
```





## Correlación


La correlación mide el grado de asociación de las variables.

Vamos a estudiar como se relacionan las variables independientes con el volumen de ventas, y también como se relacionan las variables independientes entre sí de cara a plantear la posibilidad de eliminar las variables que no necesitamos para el análisis (baja correlación con la variable objetivo o colinealidad, esto último es una correlación muy alta entre variables independientes)

El valor de la correlación lineal, me dirá cuanto va a influir la variable en el modelo de regresión linea. Aquellas variables con mayor grado de correlación (positiva o negariva), van a tener más importancia de cara a predecir el volumen de ventas que aquellas que a penas guarden relación con la variable _objetivo_

```{r}
corrData <- cor(readyData2)
#corrData 

corrplot(corrData, method = "number", 
         number.cex = 0.45 ,
         type = 'lower',
         tl.cex=0.5,
         diag = FALSE)
```

Correlación:

Tenemos que tener en cuenta que el comportamiento humano es dificil de predecir, aquellas variables que son reseñas de los clientes no son fáciles interpretar de cara a construir un modelo de predicción.


- **Volumen de ventas y reseñas de los clientes**: 
  - La variable volumen de ventas relación lineal positiva con la variable reseñas positivas (0.622) 
  - Con reseñas negativas, la relación tambien es positiva, pero es menos fuerte ( 0.309), es menos de la mitad

  
- **Volumen de ventas y reseñas del servicio prestado**: 

  - Existe una correlación lineal perfecta entre la variable target _volumen de ventas_ y la variable _5 estrellas_. Es decir, la variable objetivo queda perfectamente explicada por esta varaible y por tanto en cualquier modelo el resto de variables no van a participar. Esto es un problema de cara a construir un modelo de regresión. Debemos eliminar esta variable de mis datos y no introducirla como variable predictora del volumen de ventas

Por este motivo, vamos a estudiar como es la correlación entre las variables 1,2,3,4 y 5 estrellas y también de éstas con la variable objetivo, volumen de ventas para hacer una selección de variables y eliminar aquellas que sean necesarias.

```{r}
corrReseñas <- cor(readyData2[,c(15,16,17,18,19,28)])
corrReseñas %>% kable(booktabs=TRUE) %>% kable_styling(latex_options = "striped")

corrplot(corrReseñas, method = "number", number.cex = 0.5 ,
         type = 'lower',
         tl.cex=0.5,
         diag = FALSE)
```

Observamos que estas variables están fuertemente correladas entre ellas y esto puede indicar _colinealidad, ya que existe una alta correlación entre variables independientes_. Consideraremos que existe colinealidad a partir de una correlación de 0.9.

De esta forma, se tiene:

- **Variables 1 y 2 estrellas**: La correlación es de 0.98, es la mayor correlación existente entre dos variables independientes en todo el dataset. De estas dos variables, la correlación con la variable volumen de ventas es, respectivamente: 0.37 y 0.45, por tanto, me quedo con la variable 2 estrellas, que es la más correlada con mi variable objetivo y elimino la variable 1 estrella de mis datos

- **Variables 4 y 3 estrellas**: La correlación es 0.91, es muy alta. La variable que tiene una mayor correlación con la variable objetivo es la variable 4 estrellas (0.73), ya que 3 estrellas tiene una correlación de 0.61 con el volumen de ventas. Mantengo en mi conjunto de datos la variable 4 estrellas

Conclusión: Eliminamos del estudio las variables 3 estrellas y 2 estrellas, debido a la colinealidad existente entre estas variables y la variable 5 estrellas por una correlación perfecta, que hará que no participe ninguna variable a la hora de construir modelos de predicción:

```{r echo=TRUE}
readyData2$x5StarReviews <- NULL
readyData2$x3StarReviews  <- NULL
readyData2$x1StarReviews  <- NULL

DatosProdExistentes2$x5StarReviews <- NULL
DatosProdExistentes2$x3StarReviews <- NULL
DatosProdExistentes2$x1StarReviews <- NULL
```


  
- **Tipo de producto, precio y volumen deventas**: Parece que la variable precio guarda relación significativa con alguna de las variables tipo del producto

```{r}
corrDataType <- cor(readyData2[,c(1,2,3,4,5,6,7,8,9,10,11,12,14,25)])
#corrDataType %>% kable(booktabs=TRUE) %>% kable_styling(latex_options = "striped")
```


```{r}
corrplot(corrDataType, method = "number",
         type = 'lower',
          tl.cex=0.5,
         diag = FALSE)

```

Las variables tipo de producto están muy poco correladas con la variable objetivo _volumen de ventas_ y por tanto, a la hora de construir modelos, no van a participar a penas en la predicción de nuestra variable.

La mayor correlación con esta variable es con los juegos para la consola (0.32) y con los ordenadores portátiles.



- **Volumen de ventas y medias del artículo**: La correlación es muy baja para la variable altura del producto por tanto, esta variable no va a tener importancia a penas a la hora de predecir cuando modelemos la variable volumen de ventas con el resto de variables independientes.

|Variable        |  Cor con _Volumen_ |
|----------------|--------------------|                 
|ShippingWeight  |           -0.32    |
|ProductDepth    |            0.24    |
|ProductWidth    |           -0.22    |
|ProductHeight   |           -0.15    |




## Varianza de las variables dummy

Al estar trabajando con datos dummy, las variables de tipos de productos son 0 y 1, se trata de variables con gran cantidad de registros con un valor 0 y por tanto, esas variables tendrán una varianza muy próxima a 0. 

Esto es un problema a la hora de entrenar modelos, porque a la hora de hacer una partición en datos de entrenamiento y testeo, como es probable que tengamos variables con varianzas próximas a 0, esto supondrá errores en los algoritmos para obtener modelos de predicción.

```{r}
readyData2 %>% select(1:12) %>% head()
```


```{r}
Var = (apply(readyData2, 2, var )*(nrow(readyData2)-1))/(nrow(readyData2))
Var %>% sort(decreasing = FALSE) %>% 
  kable(caption = "Varianza de las variables. De menor a mayor",col.names = "Varianza")
```


Las varianzas de las variables _Product type_ son muy pequeñas, todas son menores que 0,2 y la más pequeña es de 0,012, correspondiente a productos de tipo consola esto son valores muy bajos para una varianza de cara a modelar.

Además, habíamos visto que prácticamente todas salvo las variables _product type_ tenían una correlación con el volumen de ventas muy baja. Optaremos por eliminar todas las variables product type de los datos de cara a elaborar modelos debido a que el problema de las varianzas tan pequeñas nos llevarán a tener peores métricas y más variabilidad en los modelos o incluso, obtener errores a la hora de aplicar los algoritmos y no poder ni construir los modelos.



## Representaciones gráficas





### Tipo de producto y volumen de ventas 

A continuación vamos a estudiar como ha sido el volumen de ventas en función del tipo de producto y el importe (en dólares) generado por cada tipo de producto.


```{r}
DatosVentas = DatosProdExistentes %>% group_by(ProductType) %>% 
  summarise(
    VolumenVentasTotal = sum(Volume),
    VolumenMedio = mean(Volume),
    ImporteVenta = sum(Volume*Price),
    MediaImporteVenta = mean(Volume*Price)
  )
DatosVentas %>% kable(booktabs=TRUE) %>% kable_styling(latex_options = "striped")
```


```{r}
ggplot(data=DatosVentas, aes(x=reorder(ProductType,-VolumenVentasTotal) , 
                                     y =VolumenVentasTotal , fill= ProductType)) + 
    geom_bar(stat="identity", position="dodge") +
   scale_y_continuous(breaks = seq(0,28000,by=5000))+
    labs(title="Gráfico de barras" ,
         subtitle= "Tipo de producto y volumen de venta histórico", 
         caption="Fuente: Elaboración propia. Conjunto de datos del histórico de ventas",
         xlab="Tipo de producto", ylab="Volumen de ventas histórico")+
  xlab("Volumen total de ventas")+
  ylab("Tipo de producto")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```


En el gráfico de barras podemos ver como los accesiorios son el tipo de productos que más volumen de ventas ha generado en las tiendas de Blackwell a lo largo de los años, seguido de las extensiones de la garantías y los videojuegos.








```{r include=FALSE }
ggplot(data=DatosVentas, aes(x=reorder(ProductType,-VolumenMedio) , 
                                     y =VolumenMedio , fill= ProductType)) + 
    geom_bar(stat="identity", position="dodge") +
   scale_y_continuous(breaks = seq(0,5000,by=500))+
    labs(title="Gráfico de barras" ,
         subtitle= "Tipo de producto y volumen medio de ventas", 
         caption="Fuente: Elaboración propia. Conjunto de datos del histórico de ventas",
         xlab="Tipo de producto", ylab="Volumen de ventas histórico")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```



Vamos a representar cada tipo de producto en función del volumen de ventas, para así tratar de entender el comportamiento de esta variable.

Nota: Vamos a representar cuatro tipo de productos: PCs, portátiles, smartphones y netbooks, que son los que nos interesa de cara a predecir su volumen de ventas.



#### Ordenadores PC


Tenemos cuatro tipos de ordenadores disponibles.

```{r}
DatosProdExistentes %>% 
  group_by(ProductType) %>% 
  filter(ProductType=="PC") %>% 
  kable(booktabs=TRUE) %>% 
  kable_styling(latex_options = "striped")
```


```{r fig.align='center'}
# df para gráfica
 df.rep = data.frame(ProductNum = c(101,102,103,142),
                    Volume = c(12,8,12,84))



ggplot(data=df.rep, aes(x=ProductNum, 
                    y=Volume, fill=ProductNum)) + 
    geom_bar(stat="identity", position="dodge")+
  scale_x_continuous(breaks = seq(100,150,by=2))+
  scale_y_continuous(breaks = seq(5,90,by=5))+
  labs(title = "Volumen histórico de ventas de PC",
       caption = "Fuente: Elaboración propia")+
  xlab("Número de identificación del producto")+
  ylab("Número de ventas")
```

La mayoría de las ventas de ordenador corresponden a ún único modelo, el producto 142 con un total de 84 ventas, mientras que los otros 3 modelos han tenido un volumen de ventas de 12, 12 y 6 unidades a lo largo de toda la historia de ventas.

#### Ordenadores portátiles

```{r}
DatosProdExistentes %>% 
  group_by(ProductType) %>% 
  filter(ProductType=="Laptop")%>% 
  kable(booktabs=TRUE) %>% 
  kable_styling(latex_options = "striped")
```

```{r}
# df para gráfica
 df.rep = data.frame(ProductNum = c(104,105,143),
                    Volume = c(196,232,88))



ggplot(data=df.rep, aes(x=ProductNum, 
                    y=Volume, fill=ProductNum)) + 
    geom_bar(stat="identity", position="dodge")+
  scale_x_continuous(breaks = seq(100,150,by=1))+
  
  scale_y_continuous(breaks = seq(0,250,by=10))+
  labs(title = "Volumen del histórico de ventas de ordenadores portátiles",
       caption = "Fuente: Elaboración propia")+
  xlab("Número de identificación del producto")+
  ylab("Número de ventas")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

El ordenador portatil 143 ha tenido un volumen bajo con respecto al los otros dos modelos de portátiles, el 105 que es el que más se ha vendido (232 unidades) y el 104, con un total de 196 ventas.


#### Smartphones

```{r}
DatosProdExistentes %>% 
  group_by(ProductType) %>% 
  filter(ProductType=="Smartphone") %>% 
  kable(booktabs=TRUE) %>% 
  kable_styling(latex_options = "striped")
```



```{r}
# df para gráfica
 df.rep = data.frame(ProductNum = c(190,191,192,197),
                    Volume = c(16,248,72,1472))



ggplot(data=df.rep, aes(x=ProductNum, 
                    y=Volume, fill=ProductNum)) + 
    geom_bar(stat="identity", position="dodge")+
  scale_x_continuous(breaks = seq(190,200,by=1))+
  scale_y_continuous(breaks = seq(0,1500,by=100))+
  labs(title = "Volumen del histórico de ventas de smartphones",
       caption = "Fuente: Elaboración propia")+
  xlab("Número de identificación del producto")+
  ylab("Número de ventas")
```


El smartphone 197 es, con gran diferencia, el que más se vende de los cuatro modelos disponibles, con un total de 1472 ventas. Por el contrario, el 190 se ha vendido 16 veces en toda la historia de la tienda.

#### Netbooks



```{r}
DatosProdExistentes %>% 
  group_by(ProductType) %>% 
  filter(ProductType=="Netbook")%>% 
  kable(booktabs=TRUE) %>% 
  kable_styling(latex_options = "striped")
```





```{r}
# df para gráfica
 df.rep = data.frame(ProductNum = c(177,182),
                    Volume = c(4,88))

ggplot(data=df.rep, aes(x=ProductNum, 
                    y=Volume, fill=ProductNum)) + 
    geom_bar(stat="identity", position="dodge")+
  scale_x_continuous(breaks = c(177,182), labels = c(177,182))+
  scale_y_continuous(breaks = seq(0,100,by=10))+
  labs(title = "Volumen del histórico de ventas de Netbooks",
       caption = "Fuente: Elaboración propia")+
  xlab("Número de identificación del producto")+
  ylab("Número de ventas")
```

El netbook 182 se vende mucho más que el 177 (4 ventas totales)


#### Comparación

Vamos a hacer una comparación global

```{r}
df.repPC = data.frame(ProductNum = c(101,102,103,142),
                    Volume = c(12,8,12,84))
df.repPort = data.frame(ProductNum = c(104,105,143),
                    Volume = c(196,232,88))
df.repSMar = data.frame(ProductNum = c(190,191,192,197),
                    Volume = c(16,248,72,1472))
df.repNet = data.frame(ProductNum = c(177,182),
                    Volume = c(4,88))
  
df = data.frame(
    ProductType = c(rep("PC",4),rep("Laptop",3),rep("Smartphone",4),rep("Netbook",2)),
    Volume=c(12,8,12,84,196,232,88,16,248,72,1472,4,88),
    ProductNum=c(101,102,103,142,104,105,143,190,191,192,197,177,182))
ggplot(data=df, aes(x=ProductNum, 
                  y=Volume, fill=ProductType)) + 
  geom_bar(stat="identity", position="dodge")+
scale_x_continuous(breaks = seq(100,200,by=3))+
scale_y_continuous(breaks = seq(0,2000,by=100))+
    theme(axis.text.x = element_text(angle = 90, hjust = 1))+
labs(title = "Comparación del volumen del histórico de ventas",
     subtitle = "Según tipo de Productos",
     caption = "Fuente: Elaboración propia")+
xlab("Número de identificación del producto")+
ylab("Número de ventas")
```


Conclusiones: 

- La mayoría de ventas corresponden a Samrthpones, en concreto al smartphone 197, con un volumen de ventas total de 1472. Con gran diferencia, este es el producto (dentro del estudio los cuatro tipos que me interesan) que más se ha vendido a lo largo de los años
- Los ordenadores tipo PC y netbook son los que menos se han vendido a lo largo de los años






```{r}
# DatosProdExistentes %>% 
#   group_by(ProductType) %>% 
#   filter(ProductType=="Accessories")
# 
# DatosProdExistentes %>% 
#   group_by(ProductType) %>% 
#   filter(ProductType=="Printer")
# 
# DatosProdExistentes %>% 
#   group_by(ProductType) %>% 
#   filter(ProductType=="ExtendedWarranty")
# 
# DatosProdExistentes %>% 
#   group_by(ProductType) %>% 
#   filter(ProductType=="Display")
# 
# DatosProdExistentes %>% 
#   group_by(ProductType) %>% 
#   filter(ProductType=="PrinterSupplies")
# DatosProdExistentes %>% 
#   group_by(ProductType) %>% 
#   filter(ProductType=="Tablet")
# 
# DatosProdExistentes %>% 
#   group_by(ProductType) %>% 
#   filter(ProductType=="GameConsole")
```













```{r include=FALSE}
### Tipo de producto y volumen ventas (importes generados) 

# A continuación, veremos una tabla en la que tenemos expresado el importe total de las # ventas generadas por cada tipo de producto, así como el valor medio, es decir, el importe # medio de las ventas generadas de cada producto.

# Vamos a representarlo gráficamente

ggplot(data=DatosVentas, aes(x=reorder(ProductType,-ImporteVenta) , 
                                     y =ImporteVenta , fill= ProductType)) + 
    geom_bar(stat="identity", position="dodge") +
   scale_y_continuous(breaks = seq(0,1800000,by=80000))+
    labs(title="Gráfico de barras" ,
         subtitle= "Tipo de producto e importe total generado según ventas", 
         caption="Fuente: Elaboración propia. Conjunto de datos del histórico de ventas"
         )+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))


ggplot(data=DatosVentas, aes(x=reorder(ProductType,-MediaImporteVenta) , 
                                     y =MediaImporteVenta , fill= ProductType)) + 
    geom_bar(stat="identity", position="dodge") +
   scale_y_continuous(breaks = seq(0,800000,by=90000))+
    labs(title="Gráfico de barras" ,
         subtitle= "Tipo de producto e importe medio generado según ventas", 
         caption="Fuente: Elaboración propia. Conjunto de datos del histórico de ventas"
         )+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))


# Vemos, que el importe medio del volumen total de ventas de los juegos de consola es de # 706413.5800 dólares. Es destacable que para accesorios, se han generado 42030.9815 euros de # media, siendo éste el tipo de producto que más se ha vendido. Esto significa que se han # realizado muchas ventas pero de un importe bajo.
```









### Reseñas vs tipo de producto

Vamos a estudiar como han sido las valoraciones de los clientes con respecto a los diferentes tipos de productos. 

Nota: como hemos eliminado variables del estudio, sólo representaremos las variables 4 y 2 estrellas.



```{r}
Reviews = 
DatosProdExistentes %>% 
  group_by(ProductType) %>% 
  summarise(
   # x5StarReviews = sum(x5StarReviews),
    x4StarReviews = sum(x4StarReviews),
   # x3StarReviews = sum(x3StarReviews),
    x2StarReviews = sum(x2StarReviews),
   # x1StarReviews = sum(x1StarReviews)
  )

Reviews %>% kable(booktabs=TRUE) %>% kable_styling(latex_options = "striped")
```

Vamos a representarlo gráficamente:



```{r}
# df para gráfica
 df.rep  = data.frame(Estrellas = rep(c(4,2),each=12),
                    Reviews = c(
                              #  Reviews$x5StarReviews,
                                Reviews$x4StarReviews,
                              #  Reviews$x3StarReviews,
                                Reviews$x2StarReviews
                               # Reviews$x1StarReviews
                               ),
                    ProductType = rep(Reviews$ProductType,2))



ggplot(data=df.rep, aes(x=Estrellas, 
                    y=Reviews, fill=ProductType)) + 
    geom_bar(stat="identity", position="dodge")+
  scale_x_continuous(breaks = c(2,4))+
  labs(title = "Reseñas de los clientes",
        
       subtitle = "Según tipo de producto",
       caption = "Fuente: Elaboración propia")+
  ylab("Número de reseñas")+
  xlab("Número de estrellas de la reseña")
```

Los productos que más reseñas de 4 estrellas han recibido son los accesorios (son los productos más vendidos)

Los productos de software han recibido un número similar de reseñas de 4 y 2 estrellas.


Vamos a ver como se comporta esta variable más concretamente para los siguientes tipos productos: PC, portátiles, netbooks y teléfonos inteligentes.

```{r}
Reviews2 = Reviews %>% 
  filter(ProductType== "PC" | ProductType== "Laptop" |ProductType== "Netbook" |
         ProductType== "Smartphone")


# df para gráfica
 df.rep2 = data.frame(Estrellas = rep(c(4,2),each=4),
                    Reviews = c(#Reviews2$x5StarReviews,
                                Reviews2$x4StarReviews,
                                #Reviews2$x3StarReviews,
                                Reviews2$x2StarReviews
                               # Reviews2$x1StarReviews
                               ),
                    ProductType = rep(Reviews2$ProductType,2))



ggplot(data=df.rep2, aes(x=Estrellas, 
                    y=Reviews, fill=ProductType)) + 
    geom_bar(stat="identity", position="dodge")+
  scale_y_continuous(breaks = seq(0,100,by=10))+
    scale_x_continuous(breaks = c(2,4))+
  labs(title = "Reseñas de los clientes",
        
       subtitle = "Según tipo de producto",
       caption = "Fuente: Elaboración propia")+
  ylab("Número de reseñas")+
  xlab("Número de estrellas de la reseña")
```


El mayor número de reseñas de 4 estrellas es para los smartphones y con un número de reseñas similar, encontramos a los ordenadores portátiles. 
Cabe destacar que los ordenadores PC no han recibido reseñas de 2 estrellas.


Para tratar de comprender el comportamiento de esta variable en el volumen de ventas, tenemos que ver cómo se comporta para cada tipo de producto cada variable por separado. 



### Impacto de las reseñas en el volumen de ventas

```{r ,out.width="50%", out.height="50%" }
scatter = DatosProdExistentes %>% 
  select(1,2,5,7,17) %>% 
  filter(ProductType=="PC" | ProductType=="Laptop" |ProductType=="Smartphone" | ProductType=="Netbook")
df.scatter = data.frame(
  reseña = rep(c("x4StarReviews","x2StarReviews"),each=13),
  Estrellas = c(
              #scatter$x5StarReviews,
              scatter$x4StarReviews,
              #scatter$x3StarReviews,
              scatter$x2StarReviews
              #scatter$x1StarReviews
              ),
  ProductNum = rep(c(101 ,102 ,103 ,104 ,105, 142 ,143, 177 ,190 ,191 ,192 ,182 ,197),2),
  ProductType = rep(scatter$ProductType,2),
  Volume = rep(scatter$Volume,2)
)

# ggplot(df.scatter, aes(x=Estrellas, y=Volume, colour=reseña)) +
#   geom_point() +
#   geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
#   scale_x_continuous(breaks = seq(0,500,by=50))+
#   scale_y_continuous(breaks = seq(0,2000,by=150))+
#     labs(title = "Impacto de las reseñas en el volumen de venta",
#        caption = "Fuente: Elaboración propia")+
#   ylab("Volumen de ventas")+
#   xlab("Número de reseñas")+
#   theme_ipsum()
```
 


Vamos a estudiar si las reseñas de los clientes guardan alguna relación con el volumen de ventas de los productos PC, Portátiles, netbooks y smartphones.


```{r ,out.width="50%", out.height="50%"}
scatter4Est = DatosProdExistentes %>% 
  select(1,2,5,17) %>% 
  filter(ProductType=="PC" | ProductType=="Laptop" |ProductType=="Smartphone" | ProductType=="Netbook")
df.scatter4Est = data.frame(
  reseña = rep(c("x4StarReviews"),each=13),
  Estrellas = c(scatter4Est$x4StarReviews),
  ProductNum = rep(c(101 ,102 ,103 ,104 ,105, 142 ,143, 177 ,190 ,191 ,192 ,182 ,197),2),
  ProductType = rep(scatter4Est$ProductType,1),
  Volume = rep(scatter4Est$Volume,1)
)


ggplot(df.scatter4Est, aes(x=Estrellas, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
        geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
 scale_x_continuous(breaks = seq(0,35,by=2))+
  scale_y_continuous(breaks = seq(0,2000,by=150))+
    labs(title = "Impacto de las reseñas en el volumen de venta",
        subtitle = "Variable 4 estrellas",
       caption = "Fuente: Elaboración propia")+
  ylab("Volumen de ventas")+
  xlab("Número de reseñas")+
  theme_ipsum()



scatter2Est = DatosProdExistentes %>% 
  select(1,2,7,17) %>% 
  filter(ProductType=="PC" | ProductType=="Laptop" |ProductType=="Smartphone" | ProductType=="Netbook")
df.scatter2Est = data.frame(
  reseña = rep(c("x2StarReviews"),each=13),
  Estrellas = c(scatter2Est$x2StarReviews),
  ProductNum = rep(c(101 ,102 ,103 ,104 ,105, 142 ,143, 177 ,190 ,191 ,192 ,182 ,197),2),
  ProductType = rep(scatter2Est$ProductType,1),
  Volume = rep(scatter2Est$Volume,1)
)


ggplot(df.scatter2Est, aes(x=Estrellas, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
      geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,15,by=1))+
  scale_y_continuous(breaks = seq(0,2000,by=150))+
    labs(title = "Impacto de las reseñas en el volumen de venta",
         subtitle = "Variable 2 estrellas",
       caption = "Fuente: Elaboración propia")+
  ylab("Volumen de ventas")+
  xlab("Número de reseñas")+
  theme_ipsum()


```


Cada punto corresponde a un artículo, identificado con su número.

Encontramos una limitación, y es que al haber tan poca cantidad de reseñas y de artículos de cada producto, es difícil tener resultados fiables.

Nota: A continuación vamos a ver modelos de predicción, la linea roja es la recta de regresión, que ha sido construida con muy pocos datos, en ocasiones sólo con dos registros. Esto va a llevar a que el modelo no sea muy fiable.

#### Ordenadores PC





```{r ,out.width="50%", out.height="50%"}
# , fig.width='200px' , fig.height='200px' 
df.scatter4EstPC = df.scatter %>% filter(ProductType=="PC" & reseña=="x4StarReviews")
ggplot(df.scatter4EstPC, aes(x=Estrellas, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,22,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto de las reseñas en el volumen de venta de PCs",
                  subtitle = "Variable 4 estrellas",
       caption = "Fuente: Elaboración propia")+
  ylab("Volumen de ventas")+
  xlab("Número de reseñas")+
  theme_ipsum()


df.scatter2EstPC = df.scatter %>% filter(ProductType=="PC" & reseña=="x2StarReviews")
ggplot(df.scatter2EstPC, aes(x=Estrellas, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,22,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto de las reseñas en el volumen de venta de PCs",
                  subtitle = "Variable 2 estrellas",
       caption = "Fuente: Elaboración propia")+
  ylab("Volumen de ventas")+
  xlab("Número de reseñas")+
  theme_ipsum()
```

Vemos como para reseñas de 4 estrellas, todos los artículos se encuentran dentro de la banda verde (intervalo de confianza). En el gráfico vemos que el artículo 142 es el que más reseñas de 4 estrellas ha recibido y también el que más se ha vendido. 

No ha habido reseñas de dos estrellas en esta variable, esto es destacable, porque a la hora de construir un modelo de predicción, para los ordenadores PC esta variable no va a influir en absoluto, mientras que para otro tipo de productos si.

#### Ordenadores portátiles


```{r ,out.width="50%", out.height="50%"}
# , fig.width='200px' , fig.height='200px' 
df.scatter4EstLaptop = df.scatter %>% filter(ProductType=="Laptop" & reseña=="x4StarReviews")
ggplot(df.scatter4EstLaptop, aes(x=Estrellas, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,30,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto de las reseñas \n en el volumen de venta de portátiles",
                  subtitle = "Variable 4 estrellas",
       caption = "Fuente: Elaboración propia")+
  ylab("Volumen de ventas")+
  xlab("Número de reseñas")+
  theme_ipsum()


df.scatter2EstLaptop= df.scatter %>% filter(ProductType=="Laptop" & reseña=="x2StarReviews")
ggplot(df.scatter2EstLaptop, aes(x=Estrellas, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,22,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto de las reseñas \n en el volumen de venta de portátitles",
                  subtitle = "Variable 2 estrellas",
       caption = "Fuente: Elaboración propia")+
  ylab("Volumen de ventas")+
  xlab("Número de reseñas")+
  theme_ipsum()
```





Únicamente tenemos 3 datos en cada gráfico y 3 datos para construir el modelo de regresión (la línea roja es la recta de regresión). Tenemos más valoraciones de 4 estrellas que de dos estrellas. La pendiente es mayor en la recta de la variable 4 estrellas.

```{r ,out.width="50%", out.height="50%", include=FALSE}
df.scatterLaptop = df.scatter %>% filter(ProductType=="Laptop")
ggplot(df.scatterLaptop, aes(x=Estrellas, y=Volume, colour=reseña,label =ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
  geom_text_repel()+
    scale_x_continuous(breaks = seq(0,60,by=5))+
  scale_y_continuous(breaks = seq(0,300,by=20))+
    labs(title = "Impacto de las reseñas en el volumen de venta de Portátiles",
       caption = "Fuente: Elaboración propia")+
  ylab("Volumen de ventas")+
  xlab("Número de reseñas")+
  theme_ipsum()



```


#### Netbooks


```{r ,out.width="50%", out.height="50%"}
# , fig.width='200px' , fig.height='200px' 
df.scatter4EstNetbook = df.scatter %>% filter(ProductType=="Netbook" & reseña=="x4StarReviews")
ggplot(df.scatter4EstNetbook, aes(x=Estrellas, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,30,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto de las reseñas \n en el volumen de venta de Netbooks",
                  subtitle = "Variable 4 estrellas",
       caption = "Fuente: Elaboración propia")+
  ylab("Volumen de ventas")+
  xlab("Número de reseñas")+
  theme_ipsum()


df.scatter2EstNetbook= df.scatter %>% filter(ProductType=="Netbook" & reseña=="x2StarReviews")
ggplot(df.scatter2EstNetbook, aes(x=Estrellas, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,22,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto de las reseñas \n en el volumen de venta de netbooks",
                  subtitle = "Variable 2 estrellas",
       caption = "Fuente: Elaboración propia")+
  ylab("Volumen de ventas")+
  xlab("Número de reseñas")+
  theme_ipsum()
```




Al haber únicamente dos modelos, vemos que la recta se ajusta a estos puntos. La pendiente de la recta vuelve a ser mayor para la variable 4 estrellas.

Con tan pocos registros, es dificil conocer como se comportan las ventas en función a las reseñas. Si podemos decir que aquellos artículos con mayor número de reseñas positivas se venden más.



```{r include=FALSE}
df.scatterNet = df.scatter %>% filter(ProductType=="Netbook")
ggplot(df.scatterNet, aes(x=Estrellas, y=Volume, colour=reseña,label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
  geom_text_repel(box.padding = 0.5, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,25,by=1))+
  scale_y_continuous(breaks = seq(0,200,by=10))+
    labs(title = "Impacto de las reseñas en el volumen de venta de Netbooks",
       caption = "Fuente: Elaboración propia")+
  ylab("Volumen de ventas")+
  xlab("Número de reseñas")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  theme_ipsum()
```

```{r ,out.width="50%", out.height="50%"}
# , fig.width='200px' , fig.height='200px' 
df.scatter4EstSmartp = df.scatter %>% filter(ProductType=="Smartphone" & reseña=="x4StarReviews")
ggplot(df.scatter4EstSmartp, aes(x=Estrellas, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,30,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto de las reseñas \n en el volumen de venta de Smartphones",
                  subtitle = "Variable 4 estrellas",
       caption = "Fuente: Elaboración propia")+
  ylab("Volumen de ventas")+
  xlab("Número de reseñas")+
  theme_ipsum()


df.scatter2EstSmartp= df.scatter %>% filter(ProductType=="Smartphone" & reseña=="x2StarReviews")
ggplot(df.scatter2EstSmartp, aes(x=Estrellas, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,22,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto de las reseñas \n en el volumen de venta de smartphones",
                  subtitle = "Variable 2 estrellas",
       caption = "Fuente: Elaboración propia")+
  ylab("Volumen de ventas")+
  xlab("Número de reseñas")+
  theme_ipsum()
```


Este tipo de productos es el que más reseñas de 4 estrellas ha recibido. Todos los puntos se encuentran dentro de los intervalos de confianza.




```{r include=FALSE}
df.scatterSmt = df.scatter %>% filter(ProductType=="Smartphone")
ggplot(df.scatterSmt, aes(x=Estrellas, y=Volume, colour=reseña,label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
  geom_text_repel(box.padding = 0.5, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,400,by=20))+
  scale_y_continuous(breaks = seq(0,2500,by=200))+
    labs(title = "Impacto de las reseñas en el volumen de venta de Smartphones",
       caption = "Fuente: Elaboración propia")+
  ylab("Volumen de ventas")+
  xlab("Número de reseñas")+
  theme_ipsum()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```



### Impacto de la evaluación del servicio en el volumen de ventas

En este apartado, nuestro objetivo es estudiar si encontramos alguna relación entre el volumen de venta histórico de un producto y el número de reseñas positivas o negativas que ha recibido por el servicio prestado.

```{r}
ServiceReview = 
DatosProdExistentes %>% 
  group_by(ProductType) %>% 
  summarise(
    PositiveServiceReview = sum(PositiveServiceReview),
    NegativeServiceReview = sum(NegativeServiceReview)
  )

ServiceReview %>% kable(booktabs=TRUE) %>% kable_styling(latex_options = "striped")

# Vamos a representarlo gráficamente:
# df para gráfica
 df.repR = data.frame(Estrellas = rep(c("Positivo","Negativo"),each=12),
                    Reviews = c(
                               ServiceReview$PositiveServiceReview,
                               ServiceReview$NegativeServiceReview),
                    ProductType = rep(ServiceReview$ProductType,2))





ggplot(data=df.repR, aes(x=Estrellas, 
                    y=Reviews, fill=ProductType)) + 
    geom_bar(stat="identity", position="dodge")+
    scale_y_continuous(breaks = seq(0,2500,by=200))+
  labs(title = "Evaluación del servicio por parte de los clientes",
        
       subtitle = "Según tipo de producto",
       caption = "Fuente: Elaboración propia")+
  ylab("n")+
  xlab("Servicio prestado")
```

Vemos que los tipos de producto _extensión de la garantía_ y _accesorios_ tienen el mayor número de evaluaciones positivas por parte de los clientes por el servicio prestado.


Vamos a ver como se comporta esta variable más concretamente para los siguientes  productos: PC, portátiles, netbooks y teléfonos inteligentes, identificando los  diferentes modelos que hay para cada tipo de producto.




```{r}


Reviews2R = ServiceReview %>% 
  filter(ProductType== "PC" | ProductType== "Laptop" |ProductType== "Netbook" |
         ProductType== "Smartphone")


# df para gráfica
 df.rep2R = data.frame(Estrellas = rep(c("Positivo","Negativo"),each=4),
                    Reviews = c(
                               Reviews2R$PositiveServiceReview,
                               Reviews2R$NegativeServiceReview),
                    ProductType = rep(Reviews2R$ProductType,2))



ggplot(data=df.rep2R, aes(x=Estrellas, 
                    y=Reviews, fill=ProductType)) + 
    geom_bar(stat="identity", position="dodge")+
  scale_y_continuous(breaks = seq(0,50,by=2))+
  labs(title = "Evaluación del servicio por los clientes",
       subtitle = "Según tipo de producto",
       caption = "Fuente: Elaboración propia")+
  ylab("Número de reseñas")+
  xlab("Servicio prestado")
```


Para estos productos, con respecto a la revisión del servicio prestado para los  ordenadores portátiles, hay un mayor número de clientes que han considerado que el  servicio prestado ha sido negativo (30) frente a los 20 que han considerado un buen  servicio. También ocurre lo mismo para los artículos tipo netbook, que ha obtenido mayor número de valoracines de un servicio negativo (4) frente a 3 positivos. 

Por el contrario, existe un mayor número de reseñas positivas en smartphones y netbooks.


Veamos como es el volumen de ventas en función del número de reseñas del servicio pero para cada tipo de producto.


```{r}
scatter2 = DatosProdExistentes %>% 
  select(1,2,9,10,17) %>% 
  filter(ProductType=="PC" | ProductType=="Laptop" |ProductType=="Smartphone" | ProductType=="Netbook")
```


```{r ,out.width="50%", out.height="50%"}

df.scatter2 = data.frame(
  reseña = rep(c("PositiveServiceReview","NegativeServiceReview"),each=13),
  Valoracion = c(scatter2$PositiveServiceReview,
                 scatter2$NegativeServiceReview),
  ProductNum = rep(c(101 ,102 ,103 ,104 ,105, 142 ,143, 177 ,190 ,191 ,192 ,182 ,197),2),
  ProductType = rep(scatter2$ProductType,2),
  Volume = rep(scatter2$Volume,2)
)

df.Positive =df.scatter2 %>% filter(reseña=="PositiveServiceReview")
df.Negative =df.scatter2 %>% filter(reseña=="NegativeServiceReview")



ggplot(df.Positive, aes(x=Valoracion, y=Volume,label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
  geom_text_repel(max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,25,by=1))+
  scale_y_continuous(breaks = seq(0,1500,by=150))+
    labs(title = "Impacto de la evaluación del servicio \n en el volumen de ventas",
         subtitle = "Variable: Reseña positiva por el servicio",
       caption = "Fuente: Elaboración propia con datos del histórico de ventas")+
  ylab("Volumen histórico de ventas")+
  xlab("Número de valoraciones recibidas")+
  theme_ipsum()



ggplot(df.Negative, aes(x=Valoracion, y=Volume,label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
  geom_text_repel(max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,25,by=1))+
  scale_y_continuous(breaks = seq(0,1500,by=150))+
    labs(title = "Impacto de la evaluación del servicio \n en el volumen de ventas",
         subtitle = "Variable: Reseña negativa por el servicio",
       caption = "Fuente: Elaboración propia con datos del histórico de ventas")+
  ylab("Volumen histórico de ventas")+
  xlab("Número de valoraciones recibidas")+
  theme_ipsum()
```

Vemos que la mayoría de puntos se sitúan en torno a la recta roja y dentro del intervalo de confianza que vemos verde. 

Cada punto representa un producto específico, identificado por un número.



Con respecto a estos gráficos, el producto 197 ha recibido 22 reseñas de servicio positivo y únicamente 3 de un servicio negativo, y ha tenido más de 1300 ventas.


No tenemos puntos con un grán número de reseñas negativas y con un gran volumen de ventas. El producto 105 ha sido el que mayor número de reseñas por un mal servicio ha recibido, en concreto 20 valoraciones negativas y únicamente 7 reseñas positivas. El volumen de ventas de este producto ha sido de casi 200 unidades.

Encontramos una limitación, y es que al haber tan poca cantidad de reseñas y de artículos de cada tipo de producto, es difícil tener resultados fiables.

#### Ordenadores tipo PC


```{r ,out.width="50%", out.height="50%"}

df.scatterPosPC = df.Positive %>% filter(ProductType=="PC" & reseña=="PositiveServiceReview")

ggplot(df.scatterPosPC, aes(x=Valoracion, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,22,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto del servicio en el volumen de ventas de PCs",
         subtitle = "Variable: Reseñas positivas por el servicio",
       caption = "Fuente: Elaboración propia con datos del histórico de ventas")+
  ylab("Volumen histórico de ventas")+
  xlab("Número de valoraciones recibidas")+
  theme_ipsum()


df.scatterNegPC = df.Negative %>% filter(ProductType=="PC" & reseña=="NegativeServiceReview")
ggplot(df.scatterNegPC, aes(x=Valoracion, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,22,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto del servicio en el volumen de ventas de PCs",
          subtitle = "Variable: Reseñas negativas por el servicio",
       caption = "Fuente: Elaboración propia con datos del histórico de ventas")+
  ylab("Volumen histórico de ventas")+
  xlab("Número de valoraciones recibidas")+
  theme_ipsum()
```







```{r include=FALSE}
df.scatter2PC = df.scatter2 %>% filter(ProductType=="PC")
ggplot(df.scatter2PC, aes(x=Valoracion, y=Volume, colour=reseña,label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
  geom_text_repel( max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,5,by=1))+
  scale_y_continuous(breaks = seq(0,100,by=10))+
    labs(title = "Impacto del servicio en el volumen de ventas de PCs",
       caption = "Fuente: Elaboración propia con datos del histórico de ventas")+
  ylab("Volumen histórico de ventas")+
  xlab("Número de valoraciones recibidas")+
  theme_ipsum()
```


#### Portátiles

```{r ,out.width="50%", out.height="50%"}

df.scatterPosPort = df.Positive %>% filter(ProductType=="Laptop" & reseña=="PositiveServiceReview")

ggplot(df.scatterPosPort, aes(x=Valoracion, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,22,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto del servicio en el volumen de ventas de Portátiles",
         subtitle = "Variable: Reseñas positivas por el servicio",
       caption = "Fuente: Elaboración propia con datos del histórico de ventas")+
  ylab("Volumen histórico de ventas")+
  xlab("Número de valoraciones recibidas")+
  theme_ipsum()


df.scatterNegPort = df.Negative %>% filter(ProductType=="Laptop" & reseña=="NegativeServiceReview")
ggplot(df.scatterNegPort, aes(x=Valoracion, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,22,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto del servicio en el volumen de ventas de Portátiles",
          subtitle = "Variable: Reseñas negativas por el servicio",
       caption = "Fuente: Elaboración propia con datos del histórico de ventas")+
  ylab("Volumen histórico de ventas")+
  xlab("Número de valoraciones recibidas")+
  theme_ipsum()
```



```{r include=FALSE}
df.scatter2Laptop = df.scatter2 %>% filter(ProductType=="Laptop")
ggplot(df.scatter2Laptop, aes(x=Valoracion, y=Volume, colour=reseña,label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
  geom_text_repel( max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,20,by=1))+
  scale_y_continuous(breaks = seq(0,400,by=50))+
    labs(title = "Impacto del servicio en el volumen de ventas de Portátiles",
       caption = "Fuente: Elaboración propia con datos del histórico de ventas")+
  ylab("Volumen histórico de ventas")+
  xlab("Número de valoraciones recibidas")+
  theme_ipsum()
```


#### Netbooks

```{r ,out.width="50%", out.height="50%"}

df.scatterPosNetb = df.Positive %>% filter(ProductType=="Netbook" & reseña=="PositiveServiceReview")

ggplot(df.scatterPosNetb, aes(x=Valoracion, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,22,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto del servicio en el volumen de ventas de Netbooks",
         subtitle = "Variable: Reseñas positivas por el servicio",
       caption = "Fuente: Elaboración propia con datos del histórico de ventas")+
  ylab("Volumen histórico de ventas")+
  xlab("Número de valoraciones recibidas")+
  theme_ipsum()


df.scatterNegNetb = df.Negative %>% filter(ProductType=="Netbook" & reseña=="NegativeServiceReview")
ggplot(df.scatterNegNetb, aes(x=Valoracion, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,3,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto del servicio en el volumen de ventas de netbooks",
          subtitle = "Variable: Reseñas negativas por el servicio",
       caption = "Fuente: Elaboración propia con datos del histórico de ventas")+
  ylab("Volumen histórico de ventas")+
  xlab("Número de valoraciones recibidas")+
  theme_ipsum()
```

Solo hay dos artículos, las rectas se ajustan a estos dos productos.

#### Smartphones


```{r include=FALSE}
df.scatter2Net = df.scatter2 %>% filter(ProductType=="Netbook")
ggplot(df.scatter2Net, aes(x=Valoracion, y=Volume, colour=reseña,label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
  geom_text_repel( max.overlaps = Inf)+
  # scale_x_continuous(breaks = seq(0,3,by=1))+
  # scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto del servicio en el volumen de ventas de Netbooks",
       caption = "Fuente: Elaboración propia con datos del histórico de ventas")+
  ylab("Volumen histórico de ventas")+
  xlab("Número de valoraciones recibidas")+
  theme_ipsum()
```

```{r ,out.width="50%", out.height="50%"}

df.scatterPosSmart= df.Positive %>% filter(ProductType=="Smartphone" & reseña=="PositiveServiceReview")

ggplot(df.scatterPosSmart, aes(x=Valoracion, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,22,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto del servicio en el volumen de ventas de Smartphones",
         subtitle = "Variable: Reseñas positivas por el servicio",
       caption = "Fuente: Elaboración propia con datos del histórico de ventas")+
  ylab("Volumen histórico de ventas")+
  xlab("Número de valoraciones recibidas")+
  theme_ipsum()


df.scatterNegSmart = df.Negative %>% filter(ProductType=="Smartphone" & reseña=="NegativeServiceReview")
ggplot(df.scatterNegSmart, aes(x=Valoracion, y=Volume, label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    geom_text_repel(box.padding = 0.3, max.overlaps = Inf)+
  scale_x_continuous(breaks = seq(0,3,by=1))+
  #scale_y_continuous(breaks = seq(0,150,by=10))+
    labs(title = "Impacto del servicio en el volumen de ventas de smartphones",
          subtitle = "Variable: Reseñas negativas por el servicio",
       caption = "Fuente: Elaboración propia con datos del histórico de ventas")+
  ylab("Volumen histórico de ventas")+
  xlab("Número de valoraciones recibidas")+
  theme_ipsum()
```


La pendiente de la recta de regresión de las reseñas positivas es mucho más inclinada que la pendiente de la variable reseñas negativas.



Hay muchas más reseñas positivas que negativas, por lo que podemos pensar que la variable reseñas positivas nos va a dar más información sobre como varían las ventas en función del tipo de producto basándonos en el número de reseñas positivas que ha recibido.


```{r include=FALSE}
df.scatter2Smt = df.scatter2 %>% filter(ProductType=="Smartphone")
ggplot(df.scatter2Smt, aes(x=Valoracion, y=Volume, colour=reseña,label=ProductNum)) +
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
  geom_text_repel(box.padding = 0.5, max.overlaps = Inf)+
   scale_x_continuous(breaks = seq(0,25,by=1))+
   scale_y_continuous(breaks = seq(0,2000,by=200))+
    labs(title = "Impacto del servicio en el volumen de ventas de Smartphones",
       caption = "Fuente: Elaboración propia con datos del histórico de ventas")+
  ylab("Volumen histórico de ventas")+
  xlab("Número de valoraciones recibidas")+
  theme_ipsum()+
  theme(axis.text.y = element_text(angle = 10, hjust = 1))
```








# Modelado y predicción del volumen de ventas

```{r - semilla}
#set.seed(17)
```


## Datos para la predicción del volumen de ventas

La variable objetivo es una variable numérica, por lo que usaremos algoritmos de regresión para tratar de modelarla en función del resto de variables independientes.

No vamos a introducir las variables binarias product type debido a que íbamos a tener variables en los datos de entrenamiento con varianzas cero o valores muy próximos a 0 y esto iba a suponer un problema a la hora de modelar el volumen de ventas.




```{r}
PredictoresRegresion<- c(
"Price",
"x4StarReviews",
"x2StarReviews",
"PositiveServiceReview", 
"NegativeServiceReview",
"Recommendproduct", 
"ShippingWeight",
"ProductDepth"  , 
"ProductWidth"  ,
"ProductHeight" , 
"ProfitMargin" 
) 
PredictoresRegresion%>% 
  kable(booktabs=TRUE,col.names = "Variables predictoras", caption="Variables para predecir el volumen de ventas") %>% 
  kable_styling(latex_options = "striped") 
```


Límite de correlación: 20%

- No hemos introducido las variables correspondientes a la medida de la altura producto debido a que la correlación era demasiado débil, ninguna llegaba al umbral mínimo necesario:  ProductHeight 

 
 





### División en datos de entrenamiento y testeo

Tomaremos una partición de 80% 20% para datos de entrenamiento y testeo. 
No dividiremos el conjunto de datos de entrenamiento en validación, ya que nuestros datos tienen una gran limitación: tenemos muy pocos registros, en concreto `r nrow(DatosProdExistentes2)` productos. Por lo que construir un modelo y entrenarlo con estos datos, además haciendo una partición para validación, nos llevaría a tener métricas muy pobres.

```{r - splitting ,echo=TRUE}
DatosRegresion <- readyData2[,c(13,14,15,16,17,
                                18,19,20,21,22,23,24,25)]

set.seed(17)
indicesEntrenamiento <- 
  createDataPartition(DatosRegresion$Volume,
                      p = .8, list = FALSE)
DatosEntreamientoR <- 
  DatosRegresion[indicesEntrenamiento,-1]

DatosTesteoR <-
  DatosRegresion[-indicesEntrenamiento,-1]

ProductNumREntrenamiento <- DatosRegresion[indicesEntrenamiento,1]
ProductNumRTesteo <- DatosRegresion[-indicesEntrenamiento,1]

DatosModelar <- readyData2[,-c(1:12)]
set.seed(17)
indicesEntrenamiento <- 
  createDataPartition(DatosModelar$Volume,
                      p = .8, list = FALSE)
DatosEntreamiento <- 
  DatosModelar[indicesEntrenamiento,-1]

DatosTesteo <-
  DatosModelar[-indicesEntrenamiento,-1]

ProductNumEntrenamiento <- DatosModelar[indicesEntrenamiento,1]
ProductNumTesteo <-        DatosModelar[-indicesEntrenamiento,1]
```






```{r}
cat("El número de registros de los datos de entrenamiento es:", nrow(DatosEntreamientoR), "\n")

cat("El número de registros de los datos de testeo es:", nrow(DatosTesteoR))
```


## Prueba de algoritmos, hiperparámetros y estrategias de optimización para predecir el volumen de ventas

Detección de los mejores algoritmos para predecir la variable numérica **volumen de ventas**, emplearemos algoritmos como árboles de regresión o modelos lineales:

En primer lugar, para la replicación de los resultados, usamos la función trainControl.


```{r echo=TRUE}
# Para todos los modelos
fitControl <- trainControl(method = "repeatedcv",
                           number = 5,
                           repeats = 3,
                          # verboseIter =TRUE 
)
```

Debido a la longitud de nuestros datos, únicamente 64 filas en los datos de entrenamiento, no podemos hacer validación cruzada con 10 folds, por lo que dividimos en 5 grupos y lo repetiremos 3 veces. 

De cara a utilizar algoritmos de regresión, haremos uso de la instrucción preProcess, de la función train, para escalar nuestras variables y que estén todas en la misma escala, de cara a obtener mejores métricas y que los modelo minimicen el error al predecir.

Vamos con los modelos para predecir el volumen de ventas


### Algoritmo 1: Regresión lineal

Utilizaremos el algoritmo _lm_ Se trata de un algoritmo de **regresión**, que genera un modelo lineal.

Aplicaremos el algoritmo a todas las columnas del dataset de entrenamiento, a excepción de la última columna, que es la que queremos predecir (volumen de ventas)


#### Hiperparametros del algoritmo 

- Número de intentos (tune length): 5
- Validación cruzaza con 10 grupos y tres repeticiones

#### Modelado



```{r echo=TRUE}
set.seed(17)
modeloRL <- train(Volume~., 
                data = DatosEntreamientoR, 
                method = "lm", 
                trControl=fitControl, 
                preProcess = c("center","scale"),
                tuneLength = 5)
summary(modeloRL)
```



Veamos la importancia de las variables en mi modelo:


```{r}
ImpRL<-varImp(modeloRL)
ImpRL


ggplot(ImpRL ) +
geom_point( color="white", size=4, alpha=0.5)+
  scale_y_continuous(breaks = seq(0,100,by=10))+
xlab('Variable')+
ylab('Importancia')+
labs(title = "Importancia de las variables",subtitle = "Modelo de regresión lineal",caption = "Fuente: elaboración propia")+
theme_minimal()
```



#### Resultados

Nota: He probado introduciendo el resto de variables y el modelo me daba peor ajuste de $R^2=0.8319$

Con estos hiperparámetros obtenemos las siguientes métricas:

- $R^2_{ajustado}=0.7905$, es decir, las variables independientes consiguen explicar un 79,05% de la variabilidad del volumen de ventas. No es un mal ajuste.
- Vemos que las variables que podemos considerar significativas a la hora de predecir las ventas de los productos son:
  - Variable 4 estrellas
  - Reseña positiva del servicio
  - Medidad de profundidad del producto
  - Altura del producto
  - Término independiente
  - Nota: la variable profit margin están al límite y también podríamos considerarlas significativas
- **Influencia de las variables en el modelo:** En este modelo, la mayoría de variables introducidas influyen fuertemente en la predicción del volumen de ventas. En concreto, las 3 variables que más influyen a la hora de predecir el volumen de ventas son:
  - Reseñas positivas por el servicio
  - 4 estrellas
  - medida de profundidad del producto. 
  El resto de variables, salvo la variable 2 estrellas (0,39%) y el precio (8,13%), influyen en el modelo con un porcentaje no muy bajo (mayor al 15%)


#### Variabilidad del modelo en la validación cruzada

```{r}
modeloRL$resample
```

Observamos que en la primera iteracción el valor de $R^2$ es de 0.72691856, que es un valor aceptable (consigo explicar casi un 73% de la variabilidad total del modelo), sin embargo, en la segunda iteracción de la primera repetición el valor de $R^2=0,32$, un valor bastante bajo. Hay mucha variabilidad en las repeticiones del valor de $R^2$, indicando así que el modelo no es fiable, a veces lo hace muy bien (llego a obtener un $R^2=0.98$) pero otras no y por tanto las predicciones tampoco tienen ninguna fiabilidad.

Tambien ocurre lo mismo con el error cuadrático medio y con el error medio absoluto, existe gran variabilidad. No es un modelo fiable.


### Algoritmo 2: Suport Vector Machine with Linear Kernel

Algoritmo de regresión _svmLinear_



#### Hiperparametros

- Validación cruzada con 5 grupos y 3 repeticiones
- Parámetro c: usaremos una malla de valores entre 1 y 3 


#### Modelado

```{r}
# Malla para hiperparámetros
SVMGrid <-  expand.grid(C = seq(1,3, length = 20))
set.seed(17)
modeloSVM <- train(Volume~., 
                data = DatosEntreamiento, 
                method = "svmLinear", 
                trControl=fitControl, 
                preProcess=c("center","scale"),
                tuneGrid = SVMGrid
                )

#resultados
modeloSVM 
```





```{r}
ImpSVM <- varImp(modeloSVM )
ImpSVM

ggplot(ImpSVM ) +
geom_point( color="green", size=4, alpha=0.5)+
  scale_y_continuous(breaks = seq(0,100,by=10))+
xlab('Variable')+
ylab('Importancia')+
labs(title = "Importancia de las variables",subtitle = "Support Vector Machine",caption = "Fuente: elaboración propia")+
theme_minimal()
```


Las variables más importantes a la hora de predecir el volumen de ventas, con más de un 50% de importancia en el modelo son las siguientes variables: reseñas positivas por el servicio, seguido de 4 estrellas, reseñas negativas y 2 estrellas. En definitiva son todas variables que refieren a la valoración que dan los clientes.



#### Resultados

El mejor modelo corresponde a aquel en el que el parámetro C es:

```{r}
modeloSVM$bestTune
```


El mejor modelo es para un valor de C=1.631579, que nos proporciona las siguientes métricas:


```{r}
modeloSVM$results[7,]
```


- $R^2=0.7457163$, es decir, las variables independientes consiguen explicar un 74,57% de la variabilidad del volumen de ventas. No es un mal ajuste.
- Error cuadrático medio (RMSE):  291.9401

#### Variabilidad del modelo en la validación cruzada

Esto es un aspecto importante, ya que si para cada modelo en la validación cruzada obtengo métricas muy distintas y por tanto, gran variabilidad, el modelo no será fiable y con ello, las predicciones tampoco.

```{r}
modeloSVM$resample
```

Observamos que en la primera iteracción el valor de $R^2$ es de 0.818, que es un buen valor (consigo obtenener un 80% de la variabilidad total del modelo), sin embargo, en la segunda iteracción de la primera repetición el valor de $R^2=0,35$, un valor bastante bajo. Hay mucha variabilidad, a veces el modelo lo hace muy bien (llego a obtener un $R^2=0.98$) pero otras no y por tanto las predicciones tampoco tienen ninguna fiabilidad.

Tambien ocurre lo mismo con el error cuadrático medio y con el error medio absoluto, existe gran variabilidad. No es un modelo fiable.







### Algoritmo 3: Random Forest Regression

#### Hiperparametros



- Validación cruzaza con 5 grupos y 3 repeticiones
- Diferentes valores de mtry 
- Número de intentos (tune length): 3

#### Modelado 

```{r}
set.seed(17)
ModeloRandomForestR <- train(Volume~., 
                data = DatosEntreamiento, 
                method = "rf", 
                trControl=fitControl, 
                preProcess=c("center","scale"),
                tuneLength = 5)

#training results
ModeloRandomForestR
```





```{r}
ImpRFR<-varImp(ModeloRandomForestR)
ImpRFR


ggplot(ImpRFR ) +
geom_point( color="white", size=4, alpha=0.5)+
  scale_y_continuous(breaks = seq(0,100,by=10))+
xlab('Variable')+
ylab('Importancia')+
labs(title = "Importancia de las variables",subtitle = "Modelo Random Forest",caption = "Fuente: elaboración propia")+
theme_minimal()
```

La variable más importante a la hora de redecir el volumen de ventas es la variable _reseña positiva del servicio_. Del resto de variables, únicamente la variable 4 estrellas participa con un 4%. La importancia del resto de variables en el modelo es prácticamente nula. 

El modelo da mucha importancia a variables que miden el comportamiento humano, que es muy dificil de modelar.




#### Gráfica del remuestreo

```{r}
ggplot(ModeloRandomForestR)+
  scale_x_continuous(breaks=seq(0,55,by=5))+
  scale_y_continuous(n.breaks = 10)+
  labs(title = "Precisión del modelo en función del valor de mtry")
```


#### Resultados

```{r}
ModeloRandomForestR$bestTune
```
Hiperparámetros del mejor modelo: mtry=11

Los resultados son, con este parámetro:


```{r}
ModeloRandomForestR$results[5,]
```


- Valor de $R^2=0.9132643$  es decir, las variables independientes consiguen explicar un 91,13% de la variabilidad del volumen de ventas. Es un buen ajuste
- Error cuadrático medio: 156.4108
- Error absoluto medio: 87.57


#### Variabilidad del modelo en la validación cruzada


```{r}
ModeloRandomForestR$resample
```
Aqú vemos como la variabilidad en las métricas es bastante menor y por tanto, el modelo será mucho más fiable de cara a predecir el volumen de ventas.

Los valores de $R^2$ varían entre 0.82 y 0.96, llegando a alcanzar incluso un valor de 0.99. Se trata del modelo más equilibrado en cuanto a métricas.

Sin embargo, observamos que el valor del error cuadrático medio si que varía para alguna iteracción. Este valor se ve muy afectado por los valores extremos, y éstos hacen que mi modelo funcione peor.







### Prueba de los modelos en los datos de testeo y elección del modelo final


Ahora realizaremos predicciones del volumen de ventas de los distintos productos con estos modelos sobre los datos de testeo , para ver con cuales obtengo mejores métricas, obteniendo así un modelo óptimo para realizar predicicones del volumen de ventas de los nuevos productos.

#### Algoritmo 1: Regresión lineal


Vamos a predecir el volumen de ventas de los diferentes productos con el modelo de regresión lineal creado antes.

##### Predicciones y evaluación del rendimiento en datos de testeo

```{r}
PredRL<-predict(modeloRL, newdata = DatosTesteoR)
# DatosTesteoR$Volume


cbind.data.frame(ProductNumRTesteo,PredRL,DatosTesteoR$Volume , abs(PredRL-DatosTesteo$Volume)) %>% 
  kable(booktabs=TRUE,caption = "Modelo de Regresión Lineal", col.names = c("Producto","Predicción","Valor real","Error absoluto en la predicción")) %>%
  kable_styling(latex_options = "striped")
```



```{r}
(PostResRL <- postResample(PredRL,DatosTesteo$Volume ))
```




#### Algoritmo 2: Suport Vector Machine with Linear Kernel

Algoritmo de regresión _svmLinear_



Los hiperparámetros del mejor modelo

```{r}
modeloSVM$bestTune
```


El mejor modelo es para un valor de C=1.631579. Vamos a aplicar el algoritmo con este valor para los datos de Testeo



```{r}
# Malla para hiperparámetros
SVMGridBEST <-  expand.grid(C = 1.631579	)
set.seed(17)
BESTmodeloSVM <- train(Volume~., 
                data = DatosEntreamiento, 
                method = "svmLinear", 
                trControl=fitControl, 
                preProcess=c("center","scale"),
                tuneGrid = SVMGridBEST)
BESTmodeloSVM
```




```{r}
BESTmodeloSVM$results
```

- $R^2=0.7457143$ Explico un 74.57% de la variabilidad total del modelo.
- Error cuadrático medio (RMSE):  291.943



##### Predicciones y evaluación del rendimiento en datos de testeo

```{r}
PredSVM<-predict(BESTmodeloSVM, newdata = DatosTesteo)
# DatosTesteoR$Volume


cbind.data.frame(ProductNumTesteo,PredSVM,DatosTesteo$Volume,abs(PredSVM-DatosTesteo$Volume)) %>% 
  kable(booktabs=TRUE,caption = "Modelo Support Vector Machine", col.names = c("Número del producto","Predicción","Valor real","Error absoluto en la predicción")) %>%
  kable_styling(latex_options = "striped")
```





```{r}
( PostResSVM <-  postResample(PredSVM,DatosTesteo$Volume ) ) 
```



#### Algoritmo 3: Random Forest Regression

Hiperparámetros del mejor modelo:


```{r}
ModeloRandomForestR$bestTune
```

Hiperparámetros del mejor modelo: mtry=11






```{r}
RFRBestGridTest <-  expand.grid(mtry=11)
set.seed(17)
BestModeloRandomForestR <- train(Volume~., 
                data = DatosEntreamiento, 
                method = "rf", 
                trControl=fitControl, 
                preProcess=c("center","scale"),
                tuneGrid= RFRBestGridTest)

#training results
BestModeloRandomForestR
```





- $R^2=0.911$ 
- Error cuadrático medio (RMSE):  528.1523


```{r}
BestModeloRandomForestR$resample
```
 Poca variabilidad en las métricas. En aquellas repeticiones de la validación cruzada en que los valores de $R^2$ es muy alto (0.99), el error cuadrático medio es muy inferior.

##### Predicciones y evaluación del rendimiento en datos testeo

```{r}
PredRFR<-predict(BestModeloRandomForestR, newdata = DatosTesteo)
# DatosTesteoR$Volume


cbind.data.frame(ProductNumTesteo,PredRFR,DatosTesteo$Volume, abs(DatosTesteo$Volume-PredRFR)) %>% 
  kable(booktabs=TRUE,caption = "Modelo Random Forest Regressor", col.names = c("Número del producto","Predicción","Valor real","Error absoluto en la predicción")) %>%
  kable_styling(latex_options = "striped")
```




```{r}
( PostResRF <- postResample(PredRFR,DatosTesteo$Volume ))
```





#### Comparación de las métricas en los cuatro modelos



```{r}
Mods<- c("Regresión lineal","SVM","Random Forest")
PostResample <- rbind(PostResRL,PostResSVM,PostResRF) 


cbind.data.frame(Mods, PostResample) %>% 
kable(booktabks=TRUE) %>% 
  kable_styling(latex_options = "striped") 


```


**Conclusión**: 

Las métricas de $R^2$ son bastante similares, en los tres modelos tengo un valor mayor de 0.8, por tanto los ajustes son buenos. Los tres modelos explican más de un 80% de la variabilidad total del volumen de ventas. El mejor valor de $R^2$ lo obtengo con el modelo Random Forest. 

Sin embargo, la diferencia entre el error cuadrático medio y el error absoluto medio:

```{r}
cbind.data.frame(Mods,PostResample[,1]- PostResample[,3]) %>% 
  kable(booktabs=TRUE,col.names = c("Modelo", "RMSE-MAE"))

```




Vemos que en el modelo en el que estas dos medidas están más cerca es en el modelo Random forest. El error cuadrático medio, por su definición, está muy influenciado por valores extremos y por tanto es en las observaciones extremas donde obtengo más error. 

Como para el último modelo tenemos la diferencia más pequeña entre estas dos métricas, tendremos menor variabilidad. Además, el error cuadrático medio más pequeño era tambien para el modelo Random forest, por tanto, es el modelo donde tengo menor influencia de los valores extremos.

Además, en el modelo SVM, hemos obtenido una predicción de  -7.18 ventas del artículo 103 y de -16 ventas del artículo 190. Esto no es admisible. Ocurre lo mismo en el modelo de regresión lineal. Sin embargo, no nos pasa esto aplicando el modelo random forest.
No podemos elegir modelos donde obtenemos predicciones de ventas negativas.


Por todos estos motivos, el algoritmo elegido para realizar predicciones del volumen de ventas de los diferentes tipos de productos, es el que nos ha proporcionado mejores métricas y menor variabilidad de éstas en la validación cruzada. Se trata del algoritmo **Random forest**



## Predicciones del volumen de ventas en el dataset de nuevos productos con Random Forest

Para realizar predicciones, es necesario preparar el conjunto de datos de nuevos productos de la misma forma que hemos preparado el de los productos existentes.

En primer lugar, hacemos dummyData


```{r, echo=TRUE}
# dummy of the data
newDataFrame <- dummyVars(" ~ .", data = DatosProdNuevos)
readyDataNewProduct <- data.frame(predict(newDataFrame, newdata = DatosProdNuevos))

readyDataNewProduct %>% kable(booktabs=TRUE, caption="Dummy data. Datos de nuevos productos") %>% kable_styling(latex_options = "striped")
```


A continuación, vamos a eliminar la variable Best Seller Rank de nuestro conjunto de datos, ya que no la hemos utilizado como variable independiente en los modelos debido a que tenía valores faltantes 

```{r , echo=TRUE}
readyDataNewProduct$BestSellersRank<- NULL # datos dummy
```

Por último, eliminamos las variables correspondientes a los tipos de productos del conjunto de datos y las variables 5,3 y 1 estrellas. 

```{r, echo=TRUE}
readyDataNewProduct2 <- readyDataNewProduct[,-c(1,2,3,4,5,6,7,8,9,10,11,12,15,17,19)]
```


Ya tenemos los datos preparados para aplicar el modelo Random Forest. Vamos a visualizar los datos.


```{r}
readyDataNewProduct2 %>% 
  kable(booktabs=TRUE) %>%
  kable_styling(latex_options = "striped")

```





Predicciones con el mejor modelo para los datos de nuevos productos. La variable product num no la introducimos para modelar. Es solo una identificación




```{r}
DatosNuevosProductos <- readyDataNewProduct2 
FinalPred <- 
  predict(BestModeloRandomForestR, newdata = DatosNuevosProductos[,-1])



cbind.data.frame(DatosNuevosProductos [,1],FinalPred) %>% 
  kable(booktabs=TRUE,caption = "Predicciones del volumen de venta en el conjunto de datos de nuevos productos",col.names = c("Número de identificación del producto","Predicción final")) %>% 
  kable_styling(latex_options = "striped")

```




Ahora vamos a unir el conjunto de datos de los nuevos productos con el valor de las predicciones de ventas

```{r}
output <- DatosProdNuevos
output$PrediccionFinal <- FinalPred
```


```{r}
output %>% 
  kable(booktabs=TRUE) %>% 
  kable_styling(latex_options = "striped")
```


```{r}
write.csv(output, file="C2.T3output.csv", row.names = TRUE)
```


Vamos a ver las predicciones finales de los tipos de productos de interés: PC, portátiles, netbooks y Smartphones

```{r}
output %>% 
  filter(ProductType=="PC" |ProductType=="Laptop" | ProductType=="Netbook" | ProductType=="Smartphone") %>% 
  select(c(1,2,19)) %>% kable(booktabs=TRUE) %>% kable_styling(latex_options = "striped")
```


# Conclusiones y recomendaciones


En este apartado exponemos aquellos aspectos interesantes para el negocio que son destacables y que permitan a la dirección establecer estrategias y tomar decisiones.


## Aspectos destacables

Es necesario destacar que este dataset tenía ciertas limitaciones que revisaremos a continuación

- Muy pocos registros, únicamente teníamos 80 registros inicialmente. Después de depurar los datos nos quedamos con 78 registros. De cara a modelar la variable volumen de ventas y hacer una partición, no hemos podido dividir en un conjunto de datos de validación, ya que entrenaríamos los modelos con muy pocos registros. Únicamente hemos dividido en datos de entrenamiento y test
- Estamos intentando explicar como se comportan las variables de reseñas por el servicio y la puntuación (5, 4 estrellas,...) pero estudiando por tipo de producto. Hay productos, como por ejemplo netbooks donde solo tenemos dos modelos, y por tanto, son muy pocos datos para sacar conclusiones claras. Aun así, las rectas de regresión de las gráficas nos indican que a mayor número de valoraciones de 4 y 2 estrellas, el volumen de ventas es mayor. Ocurre lo mismo para la variable reseñas positivas por el servicio.

- Al trabajar con variables dummy (binarias 0-1) obtenemos variables con varianzas muy próximas a 1. Esto supone que tenemos que eliminar esas variables y no las introduciremos como variables predictoras del volumen de ventas, ya que al realizar la partición, lo mas probable es que en los datos de entrenamiento tengamos variables con varianzas nulas o muy próximas a 0. Esto provocará que los algoritmos no puedan ser implementados o que tengamos mucha variabilidad.


## Métodos utilizados para modelar (resultados/métricas obtenidas)

Modelos: 

- Regresión lineal
- Suport Vector Machine
- Random Forest regressor


Las métricas obtenidas en cada uno de los modelos son las siguientes:

```{r}

cbind.data.frame(Mods, PostResample) %>% 
kable(booktabks=TRUE) %>% 
  kable_styling(latex_options = "striped") 


```



Las métricas de $R^2$ son bastante similares, en los tres modelos tengo un valor mayor de 0.8, por tanto los ajustes son buenos. Los tres modelos explican más de un 80% de la variabilidad total del volumen de ventas. El mejor valor de $R^2$ lo obtengo con el modelo Random Forest. 

Sin embargo, la diferencia entre el error cuadrático medio y el error absoluto medio:

```{r}
cbind.data.frame(Mods,PostResample[,1]- PostResample[,3]) %>% 
  kable(booktabs=TRUE,col.names = c("Modelo", "RMSE-MAE"))
```




Vemos que en el modelo en el que estas dos medidas están más cerca es en el modelo Random forest. El error cuadrático medio, por su definición, está muy influenciado por valores extremos y por tanto es en las observaciones extremas donde obtengo más error. 

Como para el último modelo tenemos la diferencia más pequeña entre estas dos métricas, tendremos menor variabilidad. Además, el error cuadrático medio más pequeño era tambien para el modelo Random forest, por tanto, es el modelo donde tengo menor influencia de los valores extremos.

Además, en el modelo SVM, hemos obtenido una predicción de  -7.18 ventas del artículo 103 y de -16 ventas del artículo 190. Esto no es admisible. Ocurre lo mismo en el modelo de regresión lineal. Sin embargo, no nos pasa esto aplicando el modelo random forest.
No podemos elegir modelos donde obtenemos predicciones de ventas negativas.


Por todos estos motivos, el algoritmo elegido para realizar predicciones del volumen de ventas de los diferentes tipos de productos, es el que nos ha proporcionado mejores métricas y menor variabilidad de éstas en la validación cruzada. 

Modelo elegido: Se trata del algoritmo **Random forest**

Es interesante destacar que el modelo da mucha importancia a variables que miden el comportamiento humano, que es muy dificil de modelar. La variable 4 estrellas va a ser determinante de cara a predecir el volumen de ventas de un determinado producto.




## Predicciones

```{r}
output %>% 
  filter(ProductType=="PC" |ProductType=="Laptop" | ProductType=="Netbook" | ProductType=="Smartphone") %>% 
  select(c(1,2,19)) %>% 
kable(booktabs=TRUE) %>% kable_styling(latex_options = "striped")
```

Vamos a representar el volumen de ventas en función del tipo de producto

```{r}
MisProds <-
output %>% 
  filter(ProductType=="PC" |ProductType=="Laptop" | ProductType=="Netbook" | ProductType=="Smartphone") 

ggplot(data=MisProds, aes(x=ProductType ,   y =PrediccionFinal , fill= ProductType)) + 
    geom_bar(stat="identity", position="dodge") +
   scale_y_continuous(breaks = seq(0,1500,by=100))+
    labs(title="Gráfico de barras" ,
         subtitle= "Tipo de producto y volumen de ventas ", 
         caption="Fuente: Elaboración propia. Conjunto de datos del histórico de ventas",
         xlab="Tipo de producto", ylab="Volumen de ventas histórico")+
  ylab("Predicción del volumen total de ventas")+
  xlab("Tipo de producto")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

La predicción es la siguiente: 

El tipo de producto que más se venderá serán los netbooks, seguido de smartphones, ordenadores PC y por último, el producto que menos se va a vender son laptops.


Vamos a ver por artículos dentro de cada tipo de productos



```{r}
output %>% 
  group_by(ProductType) %>% 
  filter(ProductType=="PC") %>% 
  kable(booktabs=TRUE) %>% 
  kable_styling(latex_options = "striped")
```


```{r fig.align='center'}
# df para gráfica
 df.rep = data.frame(ProductNum = c(171,172),
                    Volume = c(473,134))



ggplot(data=df.rep, aes(x=ProductNum, 
                    y=Volume, fill=ProductNum)) + 
    geom_bar(stat="identity", position="dodge")+
  scale_x_continuous(breaks = c(171,172))+
  #scale_y_continuous(breaks = seq(5,90,by=5))+
  labs(title = "Predicción de ventas de PC",
       caption = "Fuente: Elaboración propia")+
  xlab("Número de identificación del producto")+
  ylab("Número de ventas")
```

La predicción del volumen de ventas del PC número 171 es muy superior al del 172. Además, el número de veces que se ha valorado el producto 171 con 4 estrellas (96 veces) es mucho mayor al del producto 172 (11 veces). Además, el número de reseñas positivas por el servicio también es superior, es casi el doble (12 para el producto 171 y 7 para el 172)


```{r}
output %>% 
  group_by(ProductType) %>% 
  filter(ProductType=="Laptop") %>% 
  kable(booktabs=TRUE) %>% 
  kable_styling(latex_options = "striped")
```


```{r fig.align='center'}
# df para gráfica
 df.rep = data.frame(ProductNum = c(173,175,176),
                    Volume = c(156,30,26))



ggplot(data=df.rep, aes(x=ProductNum, 
                    y=Volume, fill=ProductNum)) + 
    geom_bar(stat="identity", position="dodge")+
  scale_x_continuous(breaks = c(173,175,176))+
  #scale_y_continuous(breaks = seq(5,90,by=5))+
  labs(title = "Predicción de ventas de portátiles",
       caption = "Fuente: Elaboración propia")+
  xlab("Número de identificación del producto")+
  ylab("Número de ventas")
```

De nuevo, el producto con más valoraciones opsitivas por el servicio y con más valoraciones de 4 estrellas es aquel al que se le ha adjudicado un valor de predicción de ventas mayor, el producto 173

```{r}
output %>% 
  group_by(ProductType) %>% 
  filter(ProductType=="Netbook") %>% 
  kable(booktabs=TRUE) %>% 
  kable_styling(latex_options = "striped")
```


```{r fig.align='center'}
# df para gráfica
 df.rep = data.frame(ProductNum = c(178,180,181,183),
                    Volume = c(82,1136,133,27))



ggplot(data=df.rep, aes(x=ProductNum, 
                    y=Volume, fill=ProductNum)) + 
    geom_bar(stat="identity", position="dodge")+
  scale_x_continuous(breaks =c(178,180,181,183))+
  scale_y_continuous(breaks = seq(0,1500,by=100))+
  labs(title = "Predicción de ventas de Netbooks",
       caption = "Fuente: Elaboración propia")+
  xlab("Número de identificación del producto")+
  ylab("Número de ventas")
```

La predicción es que la mayoría de ventas de netbooks será del producto 180, ha recibiso 112 valoraciones de 4 estrellas y 28 reseñas positivas, unos valores muy grandes en comparación al resto de artículos de este tipo.




```{r}
output %>% 
  group_by(ProductType) %>% 
  filter(ProductType=="Smartphone") %>% 
  kable(booktabs=TRUE) %>% 
  kable_styling(latex_options = "striped")
```


```{r fig.align='center'}
# df para gráfica
 df.rep = data.frame(ProductNum = c(193,194,195,196),
                    Volume = c(347,896,84,158))



ggplot(data=df.rep, aes(x=ProductNum, 
                    y=Volume, fill=ProductNum)) + 
    geom_bar(stat="identity", position="dodge")+
  scale_x_continuous(breaks =c(193,194,195,196))+
  scale_y_continuous(breaks = seq(0,1500,by=100))+
  labs(title = "Predicción de ventas de Smartphones",
       caption = "Fuente: Elaboración propia")+
  xlab("Número de identificación del producto")+
  ylab("Número de ventas")
```



La predicción de ventas de smartphones nos sugiere que se venderán casi 900 unidades del producto 194, mientras que la venta del resto de productos será bastante inferior.

Aquí, el número de valoraciones de 4 estrellas recibidas para los productos 193 y 194 es el mismo (26 valoraciones), la diferencia reside en que el producto que mayor predicción de ventas tiene es el 194, con un valor en número de reseñas positivas superior al 193 (14 frente a 8 valoraciones)


Conclusión: A la hora de predecir el volumen de ventas de un determinado artículo, la variable cuatro estrellas es determinante. Conforme más valoraciones de 4 estrellas haya recibido, mayor predicción de ventas tendrá el producto.


