---
title: "Proyecto Blackwell Electronics. Fase 1. Data Science Process"
subtitle: "Módulo 3. Tarea 2: Predicción de la marca preferida por los clientes"
author: "Marta Venegas Pardo"

date: "8/Noviembre/2021"
output:
  prettydoc::html_pretty:
    theme: leonids
    highlight: github
    toc: yes
    toc_depth: 5
    number_sections: yes
lang: es
---


```{r setup, include=FALSE,message=FALSE,warning=FALSE}
knitr::opts_chunk$set(message=FALSE,warning=FALSE , echo = FALSE
  )
```



```{r}
dire<-getwd() 
setwd(dire) 

# Librerías necesarias
library(dplyr)
library(kableExtra)
library(knitr)
```

```{r}
#install.packages("caret", dependencies = c("Depends", "Suggests"))
library(C50)
library(caret)
library(mlbench)
```




# Introducción (definición del problema)

## Objetivos

El equipo de ventas de Blackwell Electronics contrató una empresa de investigación de mercado para realizar una encuensta a los clientes con el siguiente **objetivo**:

- Averiguar, de entre todas las marcas de ordenadores en venta, cuales son las **dos marcas  preferidas** por los clientes. 

Con esta información, se podrán tomar decisiones sobre que fabricantes se debe buscar una relación estratégica mejor. 

- Sin embargo, como suele ocurrir al hacer una encuesta, las información sobre la preferencia de marcas de ordenador no quedó recogida por completo por lo que no tenemos resultados precisos.

- Por ello debemos investigar si las respuestas a *otras preguntas* de la encuesta podrían ayudarnos a predecir la preferencia de marca de ordenador de nuestros clientes

## Qué encontraremos en este informe


## Procedimiento para cumplir mis objetivos

- Descripción de datos, pre-procesado, data cleaning y análisis exploratorio
- Modelado a través de algoritmos de clasificacción (árboles de decisión), en concreto C5.0 y RandomForest
- Decisión del método que mejor funciona para predecir la marca de ordenador preferida por los clientes




# Dataset


- Conjuntos de datos:

  - **CompleteResponses**: Conjunto de datos con 10000 encuestas completas que usaremos para entrenar el modelo y construir un modelo predictivo
  - **Survey Incomplete**: Dataset para testear el mejor modelo y tratar de predecir la marca preferida por los clientes
  - **Survey key**: Encuesta (al final del documento)
  

```{r}
DatosCompletos<-read.csv(file="SurveyData/CompleteResponses.csv",header = TRUE,sep = ",",dec ="." )

DatosIncompletos<-read.csv(file="SurveyData/SurveyIncomplete.csv",header = TRUE,sep = ",",dec =".")
```


Vamos a visualizar unas cuantas líneas de los datos:

```{r}
DatosCompletos %>% 
  head(10) %>% 
  kable(booktabs=TRUE,caption = "Datos Completos")
```


```{r}
DatosIncompletos %>% 
  head(10) %>% 
  kable(booktabs=TRUE,caption = "Datos incompletos")
```



## Descripción de los datos

- Datos de entrenamiento y validación: 9898 registros, 7 variables
- Datos de testeo: 5000 registros con las mismas 7 variables

En los conjuntos de datos encontramos 7 variables :

- **Salario**: Salario anual del cliente, en dólares. (Variable numérica)
- **Edad**: Edad, en años (Variable numérica)
- **Elevel**: Nivel educativo más alto alcanzado. (Variable categórica). Corresponde a una escala de Likert

  - 0:	Less than High School Degree
  - 1:	High School Degree
  - 2:	Some College
  - 3:	4-Year College Degree
  - 4:	Master’s, Doctoral or Professional Degree
- **Car**: Marca de coche del cliente (1-20) (Variable categórica). Ver codificación al final del coumento (en la encuesta)
- **Zip**: Código postal. (categórica)

  - 0:	New England
  - 1:	Mid-Atlantic
  - 2:	East North Central
  - 3:	West North Central
  - 4:	South Atlantic
  - 5:	East South Central
  - 6:	West South Central
  - 7:	Mountain
  - 8:	Pacific
- **Credit**: Crédito total disponible (variable numérica)
- **Target. Brand**: Marca de ordenador preferida. (Variable Binaria)

  - 0:	Acer
  - 1:	Sony


```{r}
# dim(DatosCompletos)
# dim(DatosInompletos)
```



# Pre-Processing (Limpieza de datos)

```{r}
str(DatosCompletos)
```

```{r}
str(DatosIncompletos)
```


```{r}
summary(DatosCompletos)
```
```{r}
summary(DatosIncompletos)
```






## Duplicados
## Missing values
## Outliers
## Transformación de variables

### Factorización de las variables 

Recodificamos las variables categóricas para una mejor visualización de los datos

- Target: Brand
- Código Postal
- Car
- Nivel educativo

```{r}
DatosCompletosCategoricos = DatosCompletos
DatosCompletosCategoricos = DatosCompletosCategoricos%>% 
  mutate(
    Marca = factor(DatosCompletosCategoricos$brand, 
                   levels = c(0,1), 
                   labels = c("Acer", "Sony")),
    CódigoPostal = factor(DatosCompletosCategoricos$zipcode,
                          levels = c(0,1,2,3,4,5,6,7,8), 
                          labels =   c("New England","Mid-Atlantic","East North Central","West North Central","South Atlantic","East South Central","West South Central","Mountain","Pacific")),
    NivelEduc = factor(DatosCompletosCategoricos$elevel, 
                   levels = c(0,1,2,3,4), 
                   labels = c("Less HS", "HS", "SomeCollege","College Degree","Post College Decree")),
    MarcaCoche= factor(DatosCompletosCategoricos$car, 
                   levels = 1:20, 
                   labels=c("BMW","Buick","Cadillac","Chevrolet","Chrysler","Dodge","Ford","Honda","Hyundai","Jeep","Kia","Lincoln","Mazda","Mercedes Benz","Mitsubishi","Nissan","Ram","Subaru","Toyota","Other")
))%>% 
  select(c(1,2,10,11,9,6,8))


DatosCompletosCategoricos %>% head(10) %>% 
  kable(booktabs=TRUE)




DatosIncompletosCategoricos = DatosIncompletos
DatosIncompletosCategoricos = DatosIncompletosCategoricos%>% 
  mutate(
    Marca = factor(DatosIncompletosCategoricos$brand, 
                   levels = c(0,1), 
                   labels = c("Acer", "Sony")),
    CódigoPostal = factor(DatosIncompletosCategoricos$zipcode,
                          levels = c(0,1,2,3,4,5,6,7,8), 
                          labels =   c("New England","Mid-Atlantic","East North Central","West North Central","South Atlantic","East South Central","West South Central","Mountain","Pacific")),
    NivelEduc = factor(DatosIncompletosCategoricos$elevel, 
                   levels = c(0,1,2,3,4), 
                   labels = c("Less HS", "HS", "SomeCollege","College Degree","Post College Decree")),
    MarcaCoche= factor(DatosIncompletosCategoricos$car, 
                   levels = 1:20, 
                   labels=c("BMW","Buick","Cadillac","Chevrolet","Chrysler","Dodge","Ford","Honda","Hyundai","Jeep","Kia","Lincoln","Mazda","Mercedes Benz","Mitsubishi","Nissan","Ram","Subaru","Toyota","Other")
))%>% 
  select(c(1,2,10,11,9,6,8))


# DatosIncompletosCategoricos

```


## Creación de variables

# Análisis exploratorio
# Modelado y predicción de la marca preferida


## Datos para la predicción de la marca preferida
## Búsqueda de algoritmos, hiperparámetros y estrategias de optimización para predecir la marca preferida

### Detección de los mejores algoritmos (decision tree classifiers methods):

#### Algoritmo 1: C5.0
##### Hiperparametros alg 2…
##### Balanceo de datos si fuera necesario

#### Algoritmo 2: Random Forest
##### Hiperparametros…
##### Balanceo de datos…





## Validación de los modelos para la predicción de la marca preferida

En este apartado comparamos mediante en Dataset de validación los modelos con todas las estrategias de optimización que hemos decidido aplicar en el apartado anterior.

### Algoritmo 1: C5.0
#### Hiperparametros alg 2…
#### Balanceo de datos si fuera necesario

### Algoritmo 2: Random Forest
#### Hiperparametros…
#### Balanceo de datos…






## Modelo final

### Evaluación del modelo final y testeo 
### Análisis de error del modelo final 



# Predicciones

# Conclusiones y recomendaciones

En este apartado exponemos aquellos aspectos interesantes para el negocio que son destacables y que permitan a la dirección establecer estrategias y tomar decisiones.


- Métodos utilizados para modelar (resultados/métricas obtenidas)
- Modelo elegido, porqué es el mejor, nivel de confianza de las predicciones
- Las respuestas previstas a la pregunta de preferencia de marca para las instancias incompletas
- Gráfico de las preferencias del clientes (comparación de predicción y valor real)



# Encuesta (Survey Questions and Response Key)


			
## ¿Cuál es su salario anual, sin incluir bonus? (Responder con un valor numérico)	
			
## ¿Edad? (Responder con un valor numérico)	
	
## ¿Cuál es el nivel más alto de educación que ha obtenido?
		

| Value |	Description	|
|-------|-------------|
|0	    |   Less than High School Degree		|
|1	    |   High School Degree		|
|2	    |   Some College		|
|3	    |   4-Year College Degree		|
|4	    |   Master's, Doctoral or Professional Degree		|
		
## ¿Cuál es la marca de su coche?	
		
Seleccione una entre las siguientes:	
	
| Value |	Description	|
|-------|-------------|
|1	|BMW		|
|2	|Buick		|
|3	|Cadillac		|
|4	|Chevrolet		|
|5	|Chrysler		|
|6	|Dodge		|
|7	|Ford		|
|8	|Honda		|
|9	|Hyundai		|
|10|	Jeep		|
|11|	Kia		|
|12|	Lincoln		|
|13|	Mazda		|
|14|	Mercedes Benz		|
|15|	Mitsubishi		|
|16|	Nissan		|
|17|	Ram		|
|18|	Subaru		|
|19|	Toyota		|
|20|	None of the above		|
			
			
## Código postal			


| Value |	Region    	|
|-------|-------------|	
|0      |	New England		|
|1      |	Mid-Atlantic		|
|2      |	East North Central		|
|3      |	West North Central		|
|4      |	South Atlantic		|
|5      |	East South Central		|
|6      |	West South Central		|
|7      |	Mountain		|
|8      |	Pacific		|
	
## ¿Qué crédito tiene disponible?	(Número)	
	
## ¿Qué marca de ordenador prefiere?
			
	
| Value |	Region    	|
|-------|-------------|	
|0      |	Acer		    |
|1      |	Sony		    |

